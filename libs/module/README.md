# LSK.js ‚Äì module

> @lskjs/module ‚Äì Module system with dependency injection, event emitter, logger and submodules tree

[![LSK logo](https://badgen.net/badge/icon/MADE%20BY%20LSK?icon=zeit\&label\&color=red\&labelColor=red)](https://github.com/lskjs)
[![NPM version](https://badgen.net/npm/v/@lskjs/module)](https://www.npmjs.com/package/@lskjs/module)
[![NPM downloads](https://badgen.net/npm/dt/@lskjs/module)](https://www.npmjs.com/package/@lskjs/module)
[![NPM Dependency count](https://badgen.net/bundlephobia/dependency-count/@lskjs/module)](https://bundlephobia.com/result?p=@lskjs/module)
[![Have TypeScript types](https://badgen.net/npm/types/@lskjs/module)](https://www.npmjs.com/package/@lskjs/module)
[![Have tree shaking](https://badgen.net/bundlephobia/tree-shaking/@lskjs/module)](https://bundlephobia.com/result?p=@lskjs/module)
[![NPM Package size](https://badgen.net/bundlephobia/minzip/@lskjs/module)](https://bundlephobia.com/result?p=@lskjs/module)
[![Package size](https://badgen.net//github/license/lskjs/lskjs)](https://github.com/lskjs/lskjs/blob/master/LICENSE)
[![Ask us in Telegram](https://img.shields.io/badge/Ask%20us%20in-Telegram-brightblue.svg)](https://t.me/lskjschat)

<!-- template file="scripts/templates/preview.md" start -->

<!-- template end -->

***

<!-- # üìí Table of contents  -->

# Table of contents

*   [‚å®Ô∏è Install](#Ô∏è-install)

*   [@lskjs/module](#lskjsmodule)

*   [–ú–∞–Ω–∏—Ñ–µ—Å—Ç –º–æ–¥—É–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã](#–º–∞–Ω–∏—Ñ–µ—Å—Ç-–º–æ–¥—É–ª—å–Ω–æ–π-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)

    *   [–û—Å–Ω–æ–≤–Ω—ã–µ —Ü–µ–ª–∏](#–æ—Å–Ω–æ–≤–Ω—ã–µ-—Ü–µ–ª–∏)

    *   [–ü–æ–±–æ—á–Ω—ã–µ —Ñ–∏—à–∫–∏](#–ø–æ–±–æ—á–Ω—ã–µ-—Ñ–∏—à–∫–∏)

        *   [Modules lifecycle](#modules-lifecycle)
        *   [Modules stage statuses](#modules-stage-statuses)
        *   [Modules public static methods](#modules-public-static-methods)

    *   [–ü—Ä–æ—Å—Ç–æ –≤–∑—è—Ç—å –∏ —é–∑–∞—Ç—å](#–ø—Ä–æ—Å—Ç–æ-–≤–∑—è—Ç—å-–∏-—é–∑–∞—Ç—å)

    *   [–ü—Ä–æ–∫–∏–¥—ã–≤–∞—Ç—å props –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä](#–ø—Ä–æ–∫–∏–¥—ã–≤–∞—Ç—å-props-–≤-–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä)

    *   [–†–∞–∑–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å](#—Ä–∞–∑–Ω—ã–µ-—Å–ø–æ—Å–æ–±—ã-—Å–æ–∑–¥–∞–≤–∞—Ç—å)

    *   [–ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ](#–Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ)

    *   [–ö–æ–Ω—Ñ–∏–≥–∏](#–∫–æ–Ω—Ñ–∏–≥–∏)

    *   [–ü—Ä–æ–∫–∏–¥—ã–≤–∞—Ç—å –ø–æ–¥–º–æ–¥—É–ª–∏, —Ä–∞–∑–Ω—ã–º –æ–±—Ä–∞–∑–æ–º](#–ø—Ä–æ–∫–∏–¥—ã–≤–∞—Ç—å-–ø–æ–¥–º–æ–¥—É–ª–∏-—Ä–∞–∑–Ω—ã–º-–æ–±—Ä–∞–∑–æ–º)

        *   [–ö–∞–∫ props –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ](#–∫–∞–∫-props-–≤-–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ)

        *   [–ü—Ä–æ–∫–∏–¥—ã–≤–∞—Ç—å –ø–æ–¥–º–æ–¥—É–ª–∏ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞](#–ø—Ä–æ–∫–∏–¥—ã–≤–∞—Ç—å-–ø–æ–¥–º–æ–¥—É–ª–∏-—Å-–ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏-–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞)

            *   [–∫–∞–∫ field –≤ –∫–ª–∞—Å—Å–µ](#–∫–∞–∫-field-–≤-–∫–ª–∞—Å—Å–µ)
            *   [–∫–∞–∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è getter'a –≤ –∫–ª–∞—Å—Å–µ](#–∫–∞–∫-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è-gettera-–≤-–∫–ª–∞—Å—Å–µ)

        *   [–∫–∞–∫ —Å–æ–∑–¥–∞–µ–º –º–æ–¥—É–ª—å](#–∫–∞–∫-—Å–æ–∑–¥–∞–µ–º-–º–æ–¥—É–ª—å)

    *   [–ï—â–µ –Ω–µ –Ω–∞–ø–∏—Å–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#–µ—â–µ-–Ω–µ-–Ω–∞–ø–∏—Å–∞–Ω–∞-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)

    *   [–ì–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ](#–≥–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–æ–µ-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)

    *   [–í—Å—è–∫–∏–µ —Å—Å—ã–ª–∫–∏](#–≤—Å—è–∫–∏–µ-—Å—Å—ã–ª–∫–∏)

*   [=======================================](#)

*   [–ú–æ–¥—É–ª–∏ –∏ –∫–æ–Ω—Ñ–∏–≥–∏](#–º–æ–¥—É–ª–∏-–∏-–∫–æ–Ω—Ñ–∏–≥–∏)

    *   [Case 1 ‚Äì empty config](#case-1--empty-config)
    *   [Case 2 ‚Äì default config](#case-2--default-config)
    *   [Case 3 - config while creation](#case-3---config-while-creation)
    *   [Case 4 - merging default and top config](#case-4---merging-default-and-top-config)
    *   [Case 5 - async config from db](#case-5---async-config-from-db)
    *   [Case 6 - deep config merge](#case-6---deep-config-merge)
    *   [May be in future](#may-be-in-future)

*   [üìñ License](#-license)

*   [üë• Contributors](#-contributors)

*   [üëè Contributing](#-contributing)

*   [üìÆ Any questions? Always welcome :)](#-any-questions-always-welcome-)

# ‚å®Ô∏è Install

```sh
# yarn
yarn i @lskjs/module @types/lodash bluebird lodash

# npm
npm i @lskjs/module @types/lodash bluebird lodash
```

***

# @lskjs/module

–í–µ—Å—å –º–∏—Ä –º–æ–¥—É–ª—å –∏ –º—ã –≤ –Ω—ë–º –ø–æ–¥–º–æ–¥—É–ª–∏

***

–ú–æ–¥—É–ª—å - –º–æ–¥—É–ª–∏ —ç—Ç–æ –∫–ª–∞—Å—Å—ã —Å –æ–ø—Ä–µ–¥–µ–ª–Ω–Ω—ã–º –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º. –ò–∑ –º–æ–¥—É–ª–µ–π –±—É–¥–µ—Ç —Å–æ–±–∏—Ä–∞—Ç—å—Å—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, —É –º–æ–¥—É–ª–µ–π –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ–¥–º–æ–¥—É–ª–∏.

# –ú–∞–Ω–∏—Ñ–µ—Å—Ç –º–æ–¥—É–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ü–µ–ª–∏

*   –ø—Ä–æ—Å—Ç–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
*   —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ
*   —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞
*   –º–æ–¥—É–ª—å–Ω–æ—Å—Ç—å (–¥—Ä–µ–≤–æ–≤–∏–¥–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
*   –ª–µ–Ω–∏–≤–æ—Å—Ç—å (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –≤—Å–µ–≥–æ —á—Ç–æ —Ç–æ–ª—å–∫–æ –≤–æ–∑–º–æ–∂–Ω–æ)

## –ü–æ–±–æ—á–Ω—ã–µ —Ñ–∏—à–∫–∏

*   –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ª–æ–≥–≥–µ—Ä –∏ –¥–µ–±–∞–≥ —Ä–µ–∂–∏–º
*   –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π event emitter –∏ event driven
*   –∫–æ—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑ –µ–¥–∏–Ω–æ–π —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π —Ç–æ—á–∫–∏
*   —É–¥–æ–±–Ω—ã–π inject'–∏–Ω–≥ –∏–∑ –¥–µ—Ä–µ–≤–∞ –º–æ–¥—É–ª–µ–π
*   –ª–µ–≥–∫–æ–≤–µ—Å–Ω–æ—Å—Ç—å

### Modules lifecycle

*   null - –ø–æ—Å–ª–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞
*   init - —Å—Ç–∞–¥–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏, –ø–æ —Å—É—Ç–∏ —ç—Ç–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä, –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ require. –Ω–∞ —ç—Ç–æ–π —Å—Ç–∞–¥–∏–∏ —Ä–∞–±–æ—Ç–∞–µ–º –≤–Ω—É—Ç—Ä–∏ —Å–µ–±—è, –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–µ—Å—Ç—Ä–µ–Ω—Å–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã (–º–æ–¥–µ–ª–∏, –º–æ–¥—É–ª–∏, —Å–æ–∫–µ—Ç—ã, —Ñ–∞–π–ª—ã) –µ—â–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç.
*   run - —Å—Ç–∞–¥–∏—è –∑–∞–ø—É—Å–∫–∞, –¥–µ–ª–∞–µ–º –≤—Å–µ –Ω–µ–æ–±–æ—Ö–æ–¥–∏–º—ã–µ –≤–Ω–µ—à–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è, —Ç—É—Ç –º–æ–∂–Ω–æ –æ–±—Ä–∞—â—è—Ç—å—Å—è –∫ –≤–Ω–µ—à–Ω–∏–π –º–æ–¥—É–ª—è–º —Å–∏—Å—Ç–µ–º—ã: –º–æ–¥–µ–ª–∏, –º–æ–¥—É–ª–∏
*   stop - –≤—ã–∫–ª—é—á–∞–µ–º –º–æ–¥—É–ª—å, –∏–ª–∏ –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∏–ª–∏ –¥–ª—è –ø–µ—Ä–µ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è, –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ —á—Ç–æ–±—ã –≤—ã–∫–ª—é—á–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏ –æ—á–∏—Å—Ç–∏—Ç—å –ø–∞–º—è—Ç—å

### Modules stage statuses

*   null - —Ö—É–π –∑–Ω–∞–µ—Ç —á—Ç–æ —Å –Ω–∏–º, –µ—â–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª—Å—è
*   initing - —Å—Ç–∞–¥–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
*   inited - —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è
*   runing - —Å—Ç–∞–¥–∏—è –∑–∞–ø—É—Å–∫–∞
*   runned - —É–∂–µ –∑–∞–ø—É—Å—Ç–∏–ª—Å—è
*   stopping - —Å—Ç–∞–¥–∏—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
*   stoped - —É–∂–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è

### Modules public static methods

*   module.init() - –∫–∞–∫ –∫–æ–Ω—Å—Å—Ç—Ä—É–∫—Ç–æ—Ä –Ω–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π, –¥–µ–ª–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã –∏ —É—Å—Ç–∞–Ω–≤–ª–∏–≤–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–¥—É–ª—è

*   module.run() - –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –≤ –º–æ–¥—É–ª–µ

*   module.start() - init and run and some magic?

*   Module.new() - only create object

*   Module.create() - new + init

*   Module.start() - new + init + run -- init and run and some magic?

## –ü—Ä–æ—Å—Ç–æ –≤–∑—è—Ç—å –∏ —é–∑–∞—Ç—å

```js
const theModule = await TheModule.start();
theModule.name === 'TheModule'
```

## –ü—Ä–æ–∫–∏–¥—ã–≤–∞—Ç—å props –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä

```js
const theModule = await TheModule.start({ 
  mode: 'private',
  config: { 
    value: 1
  },
});
theModule.mode === 'private'
theModule.config.value === 1
```

## –†–∞–∑–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å

```js
// === Example 1 - common use === 
const m = await Module.start(props);

// === Example 2 - if you need inited modules for connection === 
const m1 = await Module.create(props);
const m2 = await Module.create(props);
m1.m2 = m2;
m2.m1 = m1;
await m1.start();
await m2.start();

// === Example 3 ‚Äì if you need uninited module  ===
const m = Module.new(props);
await m.start()
```

## –ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ

```js
class SomeModule extends Module {
  async run() {
    await super.run(); // –æ—á–µ–Ω—å –≤–∞–∂–Ω–æ –Ω–µ –∑–∞–±—ã–≤–∞—Ç—å super
    if (this.param) {
      doSomething();
    }
  } 
}

// –ü—Ä–æ–∫–∏–¥—ã–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä

const sm = await SomeModule.start({
  param: 1312,
});

```

## –ö–æ–Ω—Ñ–∏–≥–∏

```js
class OtherModule extends Module {
  async init() {
    await super.init(); // –æ—á–µ–Ω—å –≤–∞–∂–Ω–æ –Ω–µ –∑–∞–±—ã–≤–∞—Ç—å super
    if (this.config.param) {
      doSomething();
    }
  } 
}

// SomeModule from the previous example
const some = await SomeModule.start({
  param: 1,
  modules: {
    other: OtherModule,
  },
  config: {
    param: 2
    some
  }
});

const other = await m.module('other');
```

## –ü—Ä–æ–∫–∏–¥—ã–≤–∞—Ç—å –ø–æ–¥–º–æ–¥—É–ª–∏, —Ä–∞–∑–Ω—ã–º –æ–±—Ä–∞–∑–æ–º

### –ö–∞–∫ props –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ

*   –∫–∞–∫ –∫–ª–∞—Å—Å —á–µ—Ä–µ–∑ require
*   –∫–∞–∫ –ø—Ä–æ–º–∏—Å —á–µ—Ä–µ–∑ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π import
*   –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –∫–æ—Ç–æ—Ä–æ–π –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–ª–∏—Ç—å –∞—Å–∏–Ω—Ö—Ä—Ä–æ–Ω–Ω—ã–π import

```js
const theModule = new TheModule({ 
  modules: {
    permit: require('@lskjs/permit/server'),
    upload: import('@lskjs/upload/server'),
    mailer: () => import('@lskjs/mailer/server'),
  }
});
await theModule.start()
```

### –ü—Ä–æ–∫–∏–¥—ã–≤–∞—Ç—å –ø–æ–¥–º–æ–¥—É–ª–∏ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞

```js
const theModule = new TheModule({ 
  modules: {
    permit: [require('@lskjs/permit/server'), { value: 1 }],
    upload: [import('@lskjs/upload/server'), { value:2 } ],
    mailer: () => [import('@lskjs/mailer/server', { value: 3 })],
  }
});
await theModule.start()
```

#### –∫–∞–∫ field –≤ –∫–ª–∞—Å—Å–µ

```js
class TheModule extends Module {
  modules = {
    permit: require('@lskjs/permit/server'),
    upload: import('@lskjs/upload/server'),
    mailer: () => import('@lskjs/mailer/server'),
  }
}
```

#### –∫–∞–∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è getter'a –≤ –∫–ª–∞—Å—Å–µ

```js
class TheModule extends Module {

  async getModules() {
    return {
      ...await super.getModules(),
      permit: require('@lskjs/permit/server'),
      upload: import('@lskjs/upload/server'),
      mailer: () => import('@lskjs/mailer/server'),
    }
  }
}
```

### –∫–∞–∫ —Å–æ–∑–¥–∞–µ–º –º–æ–¥—É–ª—å

```js
class TheModule extends Module {
  name = 'TheModule2'; // –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏–º—è, —á—Ç–æ–±—ã —ç—Ç–æ –∏–º—è –±—ã–ª–æ –≤ –ª–æ–≥–≥–µ—Ä–µ –Ω–∞–ø—Ä–∏–º–µ—Ä
  async init() {
    await super.init();
    // –¥–µ–ª–∞–µ–º —Ç–æ, —á—Ç–æ –Ω–∞–º –Ω—É–∂–Ω–æ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    this.client = new Telegraf(this.config)
  }
  async run() {
    await super.run();
    // –¥–µ–ª–∞–µ–º —Ç–æ, —á—Ç–æ –Ω–∞–º –Ω—É–∂–Ω–æ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –º–æ–¥—É–ª—è
    this.client.launch();
  }
}
```

## –ï—â–µ –Ω–µ –Ω–∞–ø–∏—Å–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

*   –ø—Ä–æ–±–ª–µ–º–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

*   —É –º–æ–¥—É–ª—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ª–æ–≥–≥–µ—Ä

*   —É –º–æ–¥—É–ª—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å event emitter

*   –ø—Ä–æ–±–ª–µ–º–∞ –∫–æ–Ω—Ñ–∏–≥–æ–≤, —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥–æ–≤

*   –ø—Ä–æ–±–ª–µ–º–∞ –º–æ–¥–µ–ª–µ–π –∏ –º–æ–¥—É–ª—è db (–≤ init –Ω—É–∂–µ–Ω mongoose)

*   –º–æ–¥—É–ª—å

*   –ø–æ–¥–º–æ–¥—É–ª–∏

*   –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã

*   –º–æ–¥–µ–ª–∏

*   ee

*   inject

*   getModules

*   modules={}

*   new TheModule(, {providers: {}})

*   –∫–∞–∫ –ø—Ä–æ–∫–∏–¥—ã–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥–∏ –¥–∞–ª—å—à–µ?

## –ì–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

## –í—Å—è–∫–∏–µ —Å—Å—ã–ª–∫–∏

*   https://v8.dev/blog/fast-async
    \========================
    –ü—Ä–∏ –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º—ã –¥–æ–ª–∂–Ω—ã –ø–æ–ª—É—á–∞—Ç—å —Ç–æ—Ç –∂–µ —Å–∞–º—ã–π –æ–±—ä–µ–∫—Ç

# =======================================

# –ú–æ–¥—É–ª–∏ –∏ –∫–æ–Ω—Ñ–∏–≥–∏

## Case 1 ‚Äì empty config

```js
class SomeModule extends Module { }

const some = await SomeModule.start();

console.log(some.config); // {}
```

## Case 2 ‚Äì default config

```js
class SomeModule extends Module {
  config = {
    a: 1,
    b: 2
  };
}

const some = await SomeModule.start();

console.log(some.config);
// {
//   a: 1,
//   b: 2,
// }
```

***

## Case 3 - config while creation

```js
const some = await SomeModule.start({
  config: {
    a: 11,
  }
});

console.log(some.config);
// {
//   a: 11,
// }
```

## Case 4 - merging default and top config

```js
class SomeModule extends Module {
  config = {
    a: 1,
    b: 2,
    z: {
      za: 1,
      zb: 2
    }
  };
  other = {
    e: 5,
    f: 6,
  };
}

const some = await SomeModule.create({
  config: {
    a: 11,
    c: 33,
    z: {
      za: 11,
      zc: 33
    }
  },
  other: {
    e: 55,
    g: 77,
  };
})

// –ú–µ—Ä–¥–∂ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –ø–ª–æ—Å–∫–∏–º–∏, –∫–æ–Ω—Ñ–∏–≥–∞–º–∏. –ù–æ –µ—Å–ª–∏ –æ—á–µ–Ω—å —Ö–æ—á–µ—Ç—Å—è –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≥–ª—É–±–æ–∫–∏–π merge
console.log(some.config);
// {
//   a: 11,
//   b: 2,
//   c: 33,
//   z: {
//     za: 11,
//     zc: 33,
//   },
// }


// –î—Ä—É–≥–∏–µ –æ–±—ä–µ–∫—Ç—ã –ø–µ—Ä–µ—Ç–∏—Ä–∞—é—Ç—Å—è, –Ω–æ –µ—Å–ª–∏ –æ—á–µ–Ω—å —Ö–æ—á–µ—Ç—Å—è —Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∫–∞–∫ –≤ –∫–æ–Ω—Ñ–∏–≥–∞—Ö
console.log(some.other);
// {
//   e: 55,
//   g: 77,
// }
```

***

## Case 5 - async config from db

```js
class SomeModule extends Module {
  config = {
    a: 1,
    b: 2,
  };
  async getConfigFromDb() {
    return {
      fields: true,
      from: true,
      db: true,
    }
  }
  async getConfig() {
    const localConfig = await super.getConfig();
    const dbConfig = await this.getConfigFromDb().catch(err => {
      this.log.error('something wrong', err);
      if (neededFallApp) throw err
      // throw err;
      return {}
    })
    return {
      ...localConfig,
      ...dbConfig,
    };
  }
}
const some = await SomeModule.create({
  config: {
    a: 11,
    c: 33
  }
})


// if all ok
some.config === {
  a: 11,
  b: 2,
  c: 33,
  fields: true,
  from: true,
  db: true,
}

// if all error not ok
some.config === {
  a: 11,
  b: 2,
  c: 33,
}
```

## Case 6 - deep config merge

```js

class Module {
  async getConfig() {
    return {
      ...this.defaultConfig,
      ...this.config,
    }
  }
}

class Module {
  async getConfig() {
    return {
      ...this.defaultConfig,
      ...this.config,
      ...this.__config,
      deep: {
        ...this.defaultConfig.deep,
        ...this.config.deep,
        ...this.__config.deep,
        deepest: {
          ...this.defaultConfig.deep.deepest,
          ...this.config.deep.deepest,
          ...this.__config.deep.deepest,
        }
      }
    }
  }

  // or

  async getConfig() {
    return mergeDeep(
      this.defaultConfig,
      this.config,
      this.__config,
    }
  }

  defaultConfig = {
    a: 1,
    b: 2,
  };
}

const some = await SomeModule.create({
  config: {
    a: 2,
    c: 3
  }
})

some.config === {
  a: 2,
  b: 2,
  c: 3,
}


```

\=================

## May be in future

```jsx
class Uapp {

  getModules() {
   return {
     appstate: () => import('./modules/appstate'),
     i18: () => import('./modules/i18'),
   }
  }

  provide() {
    return {
      ...super.provide(),
      i18: this.modules.i18
    }
  }
}


async injectAndAwait(props) {
  const i18 = await props.i18;
  const res = {};
  if (!i18.runned) {
    await i18.run();
    res.i18 = i18;
  }
  return res;
}

@injectAndAwait('i18')
class Component {
  render() {
    const {i18} = this.props;
    return <div />
  }

}

```

# üìñ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details

# üë• Contributors

<!-- ALL-CONTRIBUTORS-LIST:START - Do not remove or modify this section -->

<!-- prettier-ignore-start -->

<!-- markdownlint-disable -->

<table>
  <tr>
    <td align="center"><a href="https://isuvorov.com"><img src="https://avatars2.githubusercontent.com/u/1056977?v=4?s=100" width="100px;" alt=""/><br /><sub><b>Igor Suvorov</b></sub></a><br /><a href="lskjs/lskjs///commits?author=isuvorov" title="Code">üíª</a> <a href="#design-isuvorov" title="Design">üé®</a> <a href="#ideas-isuvorov" title="Ideas, Planning, & Feedback">ü§î</a></td>
  </tr>
</table>
<!-- markdownlint-restore -->
<!-- prettier-ignore-end -->
<!-- ALL-CONTRIBUTORS-LIST:END -->

# üëè Contributing

1.  Fork it (<https://github.com/yourname/yourproject/fork>)
2.  Create your feature branch (`git checkout -b features/fooBar`)
3.  Commit your changes (`git commit -am 'feat(image): Add some fooBar'`)
4.  Push to the branch (`git push origin feature/fooBar`)
5.  Create a new Pull Request

# üìÆ Any questions? Always welcome :)

*   [Email](mailto:hi@isuvorov.com)
*   [LSK.news ‚Äì Telegram channel](https://t.me/lskjs)
*   [–°–ø—Ä–æ—Å–∏ –Ω–∞—Å –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–µ ;)](https://t.me/lskjschat)
