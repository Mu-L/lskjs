{"version":3,"sources":["../src/index.js"],"names":["LOG_VERSION","xxx","s","args","concat","Array","prototype","slice","call","arguments","console","error","apply","runtimeEnv","process","versions","nw","node","window","Error","os","fs","dtrace","hostname","location","host","require","util","assert","EventEmitter","stream","safeJsonStringify","env","BUNYAN_TEST_NO_SAFE_JSON_STRINGIFY","mv","sourceMapSupport","_","objCopy","obj","isArray","copy","Object","keys","forEach","k","format","inspect","formatRegExp","f","objects","i","length","push","join","len","str","String","replace","x","Number","fastAndSafeJsonStringify","getCaller3Info","undefined","saveLimit","stackTraceLimit","savePrepare","prepareStackTrace","stack","caller","wrapCallSite","file","getFileName","line","getLineNumber","func","getFunctionName","captureStackTrace","_indent","indent","lines","split","_warn","msg","dedupKey","ok","_warned","stderr","write","_haveWarned","ConsoleRawStream","rec","level","INFO","log","WARN","info","ERROR","warn","TRACE","DEBUG","FATAL","levelFromName","nameFromLevel","name","dtp","probes","resolveLevel","nameOrNum","type","toLowerCase","TypeError","Math","floor","isWritable","Writable","Logger","options","_childOptions","_childSimple","parent","streams","serializers","_isSimpleChild","_level","src","fields","parentFieldNames","names","self","closeOnExit","POSITIVE_INFINITY","createDTraceProvider","probe","addProbe","enable","addStream","stdout","addSerializers","_applySerializers","pid","inherits","defaultLevel","path","raw","reemitErrorEvents","createWriteStream","flags","encoding","RotatingFileStream","on","onStreamError","err","emit","haveNonRawStreams","field","serializer","child","simple","constructor","reopenFileStreams","end","destroySoon","value","newLevel","levels","equal","map","excludeFields","_emit","noemit","mkRecord","minLevel","msgArgs","stdSerializers","message","Buffer","isBuffer","recFields","time","Date","v","mkProbeArgs","mkLogEmitter","fire","trace","debug","fatal","req","connection","method","url","headers","remoteAddress","remotePort","res","statusCode","header","_header","getFullErrorStack","ex","ret","toString","cause","cex","errSerializer","code","signal","safeCyclesSet","seen","Set","key","val","has","add","safeCyclesArray","indexOf","safeCycles","JSON","stringify","e","count","period","m","exec","periodNum","periodScope","lastModified","fileInfo","statSync","mtime","getTime","rotateAfterOpen","lastRotTime","_calcRotTime","rotQueue","rotating","_debug","rotate","_setupNextRot","toISOString","rotAt","_setRotationTimer","delay","now","TIMEOUT_MAX","timeout","setTimeout","unref","periodOffset","d","UTC","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","dayOffset","getUTCDay","fail","toUTCString","del","toDel","n","unlink","delErr","moves","finish","before","after","exists","mvErr","q","destroy","RingBuffer","limit","writable","records","record","shift","module","exports","VERSION","createLogger"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAEA,IAAIA,WAAW,GAAG,CAAlB;;AAGA,IAAIC,GAAG,GAAG,SAASA,GAAT,CAAaC,CAAb,EAAgB;AAAM;AAC5B,MAAIC,IAAI,GAAG,CAAC,OAAO,KAAP,GAAaD,CAAd,EAAiBE,MAAjB,CACPC,KAAK,CAACC,SAAN,CAAgBC,KAAhB,CAAsBC,IAAtB,CAA2BC,SAA3B,EAAsC,CAAtC,CADO,CAAX;AAEAC,EAAAA,OAAO,CAACC,KAAR,CAAcC,KAAd,CAAoB,IAApB,EAA0BT,IAA1B;AACH,CAJD;;AAKA,IAAIF,GAAG,GAAG,SAASA,GAAT,GAAe,CAAE,CAA3B,C,CAA8B;;AAG9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,IAAIY,UAAJ;;AACA,IAAI,OAAQC,OAAR,KAAqB,WAArB,IAAoCA,OAAO,CAACC,QAAhD,EAA0D;AACtD,MAAID,OAAO,CAACC,QAAR,CAAiBC,EAArB,EAAyB;AACrBH,IAAAA,UAAU,GAAG,IAAb;AACH,GAFD,MAEO,IAAIC,OAAO,CAACC,QAAR,CAAiBE,IAArB,EAA2B;AAC9BJ,IAAAA,UAAU,GAAG,MAAb;AACH;AACJ;;AACD,IAAI,CAACA,UAAD,IAAe,OAAQK,MAAR,KAAoB,WAAnC,IACAA,MAAM,CAACA,MAAP,KAAkBA,MADtB,EAC8B;AAC1BL,EAAAA,UAAU,GAAG,SAAb;AACH;;AACD,IAAI,CAACA,UAAL,EAAiB;AACb,QAAM,IAAIM,KAAJ,CAAU,6BAAV,CAAN;AACH;;AAGD,IAAIC,EAAJ,EAAQC,EAAR,EAAYC,MAAZ;;AACA,IAAIT,UAAU,KAAK,SAAnB,EAA8B;AAC1BO,EAAAA,EAAE,GAAG;AACDG,IAAAA,QAAQ,EAAE,oBAAY;AAClB,aAAOL,MAAM,CAACM,QAAP,CAAgBC,IAAvB;AACH;AAHA,GAAL;AAKAJ,EAAAA,EAAE,GAAG,EAAL;AACAC,EAAAA,MAAM,GAAG,IAAT;AACH,CARD,MAQO;AACHF,EAAAA,EAAE,GAAGM,OAAO,CAAC,IAAD,CAAZ;AACAL,EAAAA,EAAE,GAAGK,OAAO,CAAC,IAAD,CAAZ,CAFG,CAGH;AACA;AACA;;AACIJ,EAAAA,MAAM,GAAG,IAAT,CAND,CAOH;AACH;;AACD,IAAIK,IAAI,GAAGD,OAAO,CAAC,MAAD,CAAlB;;AACA,IAAIE,MAAM,GAAGF,OAAO,CAAC,QAAD,CAApB;;AACA,IAAIG,YAAY,GAAGH,OAAO,CAAC,QAAD,CAAP,CAAkBG,YAArC;;AACA,IAAIC,MAAM,GAAGJ,OAAO,CAAC,QAAD,CAApB,C,CAEA;AACA;AACA;;;AACI,IAAIK,iBAAiB,GAAG,IAAxB,C,CACJ;;AACA,IAAIjB,OAAO,CAACkB,GAAR,CAAYC,kCAAhB,EAAoD;AAChDF,EAAAA,iBAAiB,GAAG,IAApB;AACH,C,CAED;AACA;AACA;AACA;;;AACI,IAAIG,EAAE,GAAG,IAAT,C,CACJ;;AAEA,IAAI;AACA,MAAIC,gBAAgB,GAAGT,OAAO,CAAC,uBAAuB,EAAxB,CAA9B;AACH,CAFD,CAEE,OAAOU,CAAP,EAAU;AACRD,EAAAA,gBAAgB,GAAG,IAAnB;AACH,C,CAGD;;AAEA;AACA;AACA;AACA;;;AACA,SAASE,OAAT,CAAiBC,GAAjB,EAAsB;AAClB,MAAIA,GAAG,IAAI,IAAX,EAAiB;AAAG;AAChB,WAAOA,GAAP;AACH,GAFD,MAEO,IAAIjC,KAAK,CAACkC,OAAN,CAAcD,GAAd,CAAJ,EAAwB;AAC3B,WAAOA,GAAG,CAAC/B,KAAJ,EAAP;AACH,GAFM,MAEA,IAAI,yBAAQ+B,GAAR,MAAiB,QAArB,EAA+B;AAClC,QAAIE,IAAI,GAAG,EAAX;AACAC,IAAAA,MAAM,CAACC,IAAP,CAAYJ,GAAZ,EAAiBK,OAAjB,CAAyB,UAAUC,CAAV,EAAa;AAClCJ,MAAAA,IAAI,CAACI,CAAD,CAAJ,GAAUN,GAAG,CAACM,CAAD,CAAb;AACH,KAFD;AAGA,WAAOJ,IAAP;AACH,GANM,MAMA;AACH,WAAOF,GAAP;AACH;AACJ;;AAED,IAAIO,MAAM,GAAGlB,IAAI,CAACkB,MAAlB;;AACA,IAAI,CAACA,MAAL,EAAa;AACT;AACA;AACA,MAAIC,OAAO,GAAGnB,IAAI,CAACmB,OAAnB;AACA,MAAIC,YAAY,GAAG,UAAnB;;AACAF,EAAAA,MAAM,GAAG,SAASA,MAAT,CAAgBG,CAAhB,EAAmB;AACxB,QAAI,OAAQA,CAAR,KAAe,QAAnB,EAA6B;AACzB,UAAIC,OAAO,GAAG,EAAd;;AACA,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGzC,SAAS,CAAC0C,MAA9B,EAAsCD,CAAC,EAAvC,EAA2C;AACvCD,QAAAA,OAAO,CAACG,IAAR,CAAaN,OAAO,CAACrC,SAAS,CAACyC,CAAD,CAAV,CAApB;AACH;;AACD,aAAOD,OAAO,CAACI,IAAR,CAAa,GAAb,CAAP;AACH;;AAED,QAAIH,CAAC,GAAG,CAAR;AACA,QAAI/C,IAAI,GAAGM,SAAX;AACA,QAAI6C,GAAG,GAAGnD,IAAI,CAACgD,MAAf;AACA,QAAII,GAAG,GAAGC,MAAM,CAACR,CAAD,CAAN,CAAUS,OAAV,CAAkBV,YAAlB,EAAgC,UAAUW,CAAV,EAAa;AACnD,UAAIR,CAAC,IAAII,GAAT,EACI,OAAOI,CAAP;;AACJ,cAAQA,CAAR;AACI,aAAK,IAAL;AAAW,iBAAOF,MAAM,CAACrD,IAAI,CAAC+C,CAAC,EAAF,CAAL,CAAb;;AACX,aAAK,IAAL;AAAW,iBAAOS,MAAM,CAACxD,IAAI,CAAC+C,CAAC,EAAF,CAAL,CAAb;;AACX,aAAK,IAAL;AAAW,iBAAOU,wBAAwB,CAACzD,IAAI,CAAC+C,CAAC,EAAF,CAAL,CAA/B;;AACX,aAAK,IAAL;AAAW,iBAAO,GAAP;;AACX;AACI,iBAAOQ,CAAP;AANR;AAQH,KAXS,CAAV;;AAYA,SAAK,IAAIA,CAAC,GAAGvD,IAAI,CAAC+C,CAAD,CAAjB,EAAsBA,CAAC,GAAGI,GAA1B,EAA+BI,CAAC,GAAGvD,IAAI,CAAC,EAAE+C,CAAH,CAAvC,EAA8C;AAC1C,UAAIQ,CAAC,KAAK,IAAN,IAAc,yBAAQA,CAAR,MAAe,QAAjC,EAA2C;AACvCH,QAAAA,GAAG,IAAI,MAAMG,CAAb;AACH,OAFD,MAEO;AACHH,QAAAA,GAAG,IAAI,MAAMT,OAAO,CAACY,CAAD,CAApB;AACH;AACJ;;AACD,WAAOH,GAAP;AACH,GAhCD;AAiCH;AAGD;AACA;AACA;AACA;;;AACA,SAASM,cAAT,GAA0B;AACtB,MAAI,SAASC,SAAb,EAAwB;AACpB;AACA;AACH;;AACD,MAAIxB,GAAG,GAAG,EAAV;AACA,MAAIyB,SAAS,GAAG5C,KAAK,CAAC6C,eAAtB;AACA,MAAIC,WAAW,GAAG9C,KAAK,CAAC+C,iBAAxB;AACA/C,EAAAA,KAAK,CAAC6C,eAAN,GAAwB,CAAxB;;AAEA7C,EAAAA,KAAK,CAAC+C,iBAAN,GAA0B,UAAU9B,CAAV,EAAa+B,KAAb,EAAoB;AAC1C,QAAIC,MAAM,GAAGD,KAAK,CAAC,CAAD,CAAlB;;AACA,QAAIhC,gBAAJ,EAAsB;AAClBiC,MAAAA,MAAM,GAAGjC,gBAAgB,CAACkC,YAAjB,CAA8BD,MAA9B,CAAT;AACH;;AACD9B,IAAAA,GAAG,CAACgC,IAAJ,GAAWF,MAAM,CAACG,WAAP,EAAX;AACAjC,IAAAA,GAAG,CAACkC,IAAJ,GAAWJ,MAAM,CAACK,aAAP,EAAX;AACA,QAAIC,IAAI,GAAGN,MAAM,CAACO,eAAP,EAAX;AACA,QAAID,IAAJ,EACIpC,GAAG,CAACoC,IAAJ,GAAWA,IAAX;AACP,GAVD;;AAWAvD,EAAAA,KAAK,CAACyD,iBAAN,CAAwB,IAAxB,EAA8Bf,cAA9B;AACA,OAAKM,KAAL;AAEAhD,EAAAA,KAAK,CAAC6C,eAAN,GAAwBD,SAAxB;AACA5C,EAAAA,KAAK,CAAC+C,iBAAN,GAA0BD,WAA1B;AACA,SAAO3B,GAAP;AACH;;AAGD,SAASuC,OAAT,CAAiB3E,CAAjB,EAAoB4E,MAApB,EAA4B;AACxB,MAAI,CAACA,MAAL,EAAaA,MAAM,GAAG,MAAT;AACb,MAAIC,KAAK,GAAG7E,CAAC,CAAC8E,KAAF,CAAQ,QAAR,CAAZ;AACA,SAAOF,MAAM,GAAGC,KAAK,CAAC1B,IAAN,CAAW,OAAOyB,MAAlB,CAAhB;AACH;AAGD;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASG,KAAT,CAAeC,GAAf,EAAoBC,QAApB,EAA8B;AAC1BvD,EAAAA,MAAM,CAACwD,EAAP,CAAUF,GAAV;;AACA,MAAIC,QAAJ,EAAc;AACV,QAAIE,OAAO,CAACF,QAAD,CAAX,EAAuB;AACnB;AACH;;AACDE,IAAAA,OAAO,CAACF,QAAD,CAAP,GAAoB,IAApB;AACH;;AACDrE,EAAAA,OAAO,CAACwE,MAAR,CAAeC,KAAf,CAAqBL,GAAG,GAAG,IAA3B;AACH;;AACD,SAASM,WAAT,CAAqBL,QAArB,EAA+B;AAC3B,SAAOE,OAAO,CAACF,QAAD,CAAd;AACH;;AACD,IAAIE,OAAO,GAAG,EAAd;;AAGA,SAASI,gBAAT,GAA4B,CAAE;;AAC9BA,gBAAgB,CAACnF,SAAjB,CAA2BiF,KAA3B,GAAmC,UAAUG,GAAV,EAAe;AAC9C,MAAIA,GAAG,CAACC,KAAJ,GAAYC,IAAhB,EAAsB;AAClBlF,IAAAA,OAAO,CAACmF,GAAR,CAAYH,GAAZ;AACH,GAFD,MAEO,IAAIA,GAAG,CAACC,KAAJ,GAAYG,IAAhB,EAAsB;AACzBpF,IAAAA,OAAO,CAACqF,IAAR,CAAaL,GAAb;AACH,GAFM,MAEA,IAAIA,GAAG,CAACC,KAAJ,GAAYK,KAAhB,EAAuB;AAC1BtF,IAAAA,OAAO,CAACuF,IAAR,CAAaP,GAAb;AACH,GAFM,MAEA;AACHhF,IAAAA,OAAO,CAACC,KAAR,CAAc+E,GAAd;AACH;AACJ,CAVD,C,CAaA;;;AAEA,IAAIQ,KAAK,GAAG,EAAZ;AACA,IAAIC,KAAK,GAAG,EAAZ;AACA,IAAIP,IAAI,GAAG,EAAX;AACA,IAAIE,IAAI,GAAG,EAAX;AACA,IAAIE,KAAK,GAAG,EAAZ;AACA,IAAII,KAAK,GAAG,EAAZ;AAEA,IAAIC,aAAa,GAAG;AAChB,WAASH,KADO;AAEhB,WAASC,KAFO;AAGhB,UAAQP,IAHQ;AAIhB,UAAQE,IAJQ;AAKhB,WAASE,KALO;AAMhB,WAASI;AANO,CAApB;AAQA,IAAIE,aAAa,GAAG,EAApB;AACA7D,MAAM,CAACC,IAAP,CAAY2D,aAAZ,EAA2B1D,OAA3B,CAAmC,UAAU4D,IAAV,EAAgB;AAC/CD,EAAAA,aAAa,CAACD,aAAa,CAACE,IAAD,CAAd,CAAb,GAAqCA,IAArC;AACH,CAFD,E,CAIA;;AACA,IAAIC,GAAG,GAAG1C,SAAV;AACA,IAAI2C,MAAM,GAAGnF,MAAM,IAAI,EAAvB;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,SAASoF,YAAT,CAAsBC,SAAtB,EAAiC;AAC7B,MAAIhB,KAAJ;AACA,MAAIiB,IAAI,4BAAWD,SAAX,CAAR;;AACA,MAAIC,IAAI,KAAK,QAAb,EAAuB;AACnBjB,IAAAA,KAAK,GAAGU,aAAa,CAACM,SAAS,CAACE,WAAV,EAAD,CAArB;;AACA,QAAI,CAAClB,KAAL,EAAY;AACR,YAAM,IAAIxE,KAAJ,CAAU0B,MAAM,CAAC,0BAAD,EAA6B8D,SAA7B,CAAhB,CAAN;AACH;AACJ,GALD,MAKO,IAAIC,IAAI,KAAK,QAAb,EAAuB;AAC1B,UAAM,IAAIE,SAAJ,CAAcjE,MAAM,CAAC,yCAAD,EACtB+D,IADsB,EAChBD,SADgB,CAApB,CAAN;AAEH,GAHM,MAGA,IAAIA,SAAS,GAAG,CAAZ,IAAiBI,IAAI,CAACC,KAAL,CAAWL,SAAX,MAA0BA,SAA/C,EAA0D;AAC7D,UAAM,IAAIG,SAAJ,CAAcjE,MAAM,CAAC,qCAAD,EACtB8D,SADsB,CAApB,CAAN;AAEH,GAHM,MAGA;AACHhB,IAAAA,KAAK,GAAGgB,SAAR;AACH;;AACD,SAAOhB,KAAP;AACH;;AAGD,SAASsB,UAAT,CAAoB3E,GAApB,EAAyB;AACrB,MAAIA,GAAG,YAAYR,MAAM,CAACoF,QAA1B,EAAoC;AAChC,WAAO,IAAP;AACH;;AACD,SAAO,OAAQ5E,GAAG,CAACiD,KAAZ,KAAuB,UAA9B;AACH,C,CAGD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAAS4B,MAAT,CAAgBC,OAAhB,EAAyBC,aAAzB,EAAwCC,YAAxC,EAAsD;AAClDrH,EAAAA,GAAG,CAAC,eAAD,EAAkBmH,OAAlB,CAAH;;AACA,MAAI,EAAE,gBAAgBD,MAAlB,CAAJ,EAA+B;AAC3B,WAAO,IAAIA,MAAJ,CAAWC,OAAX,EAAoBC,aAApB,CAAP;AACH,GAJiD,CAMlD;;;AACA,MAAIE,MAAJ;;AACA,MAAIF,aAAa,KAAKvD,SAAtB,EAAiC;AAC7ByD,IAAAA,MAAM,GAAGH,OAAT;AACAA,IAAAA,OAAO,GAAGC,aAAV;;AACA,QAAI,EAAEE,MAAM,YAAYJ,MAApB,CAAJ,EAAiC;AAC7B,YAAM,IAAIL,SAAJ,CACF,mDADE,CAAN;AAEH;AACJ;;AACD,MAAI,CAACM,OAAL,EAAc;AACV,UAAM,IAAIN,SAAJ,CAAc,8BAAd,CAAN;AACH;;AACD,MAAI,CAACS,MAAL,EAAa;AACT,QAAI,CAACH,OAAO,CAACb,IAAb,EAAmB;AACf,YAAM,IAAIO,SAAJ,CAAc,mCAAd,CAAN;AACH;AACJ,GAJD,MAIO;AACH,QAAIM,OAAO,CAACb,IAAZ,EAAkB;AACd,YAAM,IAAIO,SAAJ,CACF,oDADE,CAAN;AAEH;AACJ;;AACD,MAAIM,OAAO,CAACtF,MAAR,IAAkBsF,OAAO,CAACI,OAA9B,EAAuC;AACnC,UAAM,IAAIV,SAAJ,CAAc,2CAAd,CAAN;AACH;;AACD,MAAIM,OAAO,CAACI,OAAR,IAAmB,CAACnH,KAAK,CAACkC,OAAN,CAAc6E,OAAO,CAACI,OAAtB,CAAxB,EAAwD;AACpD,UAAM,IAAIV,SAAJ,CAAc,2CAAd,CAAN;AACH;;AACD,MAAIM,OAAO,CAACK,WAAR,KAAwB,yBAAQL,OAAO,CAACK,WAAhB,MAAiC,QAAjC,IACpBpH,KAAK,CAACkC,OAAN,CAAc6E,OAAO,CAACK,WAAtB,CADJ,CAAJ,EAC6C;AACzC,UAAM,IAAIX,SAAJ,CAAc,gDAAd,CAAN;AACH;;AAEDjF,EAAAA,YAAY,CAACrB,IAAb,CAAkB,IAAlB,EAxCkD,CA0ClD;;AACA,MAAI+G,MAAM,IAAID,YAAd,EAA4B;AACxB;AACA;AACA,SAAKI,cAAL,GAAsB,IAAtB;AAEA,SAAKC,MAAL,GAAcJ,MAAM,CAACI,MAArB;AACA,SAAKH,OAAL,GAAeD,MAAM,CAACC,OAAtB;AACA,SAAKC,WAAL,GAAmBF,MAAM,CAACE,WAA1B;AACA,SAAKG,GAAL,GAAWL,MAAM,CAACK,GAAlB;AACA,QAAIC,MAAM,GAAG,KAAKA,MAAL,GAAc,EAA3B;AACA,QAAIC,gBAAgB,GAAGrF,MAAM,CAACC,IAAP,CAAY6E,MAAM,CAACM,MAAnB,CAAvB;;AACA,SAAK,IAAI3E,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG4E,gBAAgB,CAAC3E,MAArC,EAA6CD,CAAC,EAA9C,EAAkD;AAC9C,UAAIqD,IAAI,GAAGuB,gBAAgB,CAAC5E,CAAD,CAA3B;AACA2E,MAAAA,MAAM,CAACtB,IAAD,CAAN,GAAegB,MAAM,CAACM,MAAP,CAActB,IAAd,CAAf;AACH;;AACD,QAAIwB,KAAK,GAAGtF,MAAM,CAACC,IAAP,CAAY0E,OAAZ,CAAZ;;AACA,SAAK,IAAIlE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG6E,KAAK,CAAC5E,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;AACnC,UAAIqD,IAAI,GAAGwB,KAAK,CAAC7E,CAAD,CAAhB;AACA2E,MAAAA,MAAM,CAACtB,IAAD,CAAN,GAAea,OAAO,CAACb,IAAD,CAAtB;AACH;;AACD;AACH,GAhEiD,CAkElD;;;AACA,MAAIyB,IAAI,GAAG,IAAX;;AACA,MAAIT,MAAJ,EAAY;AACR,SAAKI,MAAL,GAAcJ,MAAM,CAACI,MAArB;AACA,SAAKH,OAAL,GAAe,EAAf;;AACA,SAAK,IAAItE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGqE,MAAM,CAACC,OAAP,CAAerE,MAAnC,EAA2CD,CAAC,EAA5C,EAAgD;AAC5C,UAAIhD,CAAC,GAAGmC,OAAO,CAACkF,MAAM,CAACC,OAAP,CAAetE,CAAf,CAAD,CAAf;AACAhD,MAAAA,CAAC,CAAC+H,WAAF,GAAgB,KAAhB,CAF4C,CAErB;;AACvB,WAAKT,OAAL,CAAapE,IAAb,CAAkBlD,CAAlB;AACH;;AACD,SAAKuH,WAAL,GAAmBpF,OAAO,CAACkF,MAAM,CAACE,WAAR,CAA1B;AACA,SAAKG,GAAL,GAAWL,MAAM,CAACK,GAAlB;AACA,SAAKC,MAAL,GAAcxF,OAAO,CAACkF,MAAM,CAACM,MAAR,CAArB;;AACA,QAAIT,OAAO,CAACzB,KAAZ,EAAmB;AACf,WAAKA,KAAL,CAAWyB,OAAO,CAACzB,KAAnB;AACH;AACJ,GAdD,MAcO;AACH,SAAKgC,MAAL,GAAchE,MAAM,CAACuE,iBAArB;AACA,SAAKV,OAAL,GAAe,EAAf;AACA,SAAKC,WAAL,GAAmB,IAAnB;AACA,SAAKG,GAAL,GAAW,KAAX;AACA,SAAKC,MAAL,GAAc,EAAd;AACH;;AAED,MAAI,CAACrB,GAAD,IAAQlF,MAAZ,EAAoB;AAChBkF,IAAAA,GAAG,GAAGlF,MAAM,CAAC6G,oBAAP,CAA4B,QAA5B,CAAN;;AAEA,SAAK,IAAIxC,KAAT,IAAkBU,aAAlB,EAAiC;AAC7B,UAAI+B,KAAJ;AAEA3B,MAAAA,MAAM,CAACJ,aAAa,CAACV,KAAD,CAAd,CAAN,GAA+ByC,KAAK,GAChC5B,GAAG,CAAC6B,QAAJ,CAAa,SAAS1C,KAAtB,EAA6B,QAA7B,CADJ,CAH6B,CAM7B;;AACAyC,MAAAA,KAAK,CAAC5B,GAAN,GAAYA,GAAZ;AACH;;AAEDA,IAAAA,GAAG,CAAC8B,MAAJ;AACH,GAxGiD,CA0GlD;AACA;;;AACA,MAAIlB,OAAO,CAACtF,MAAZ,EAAoB;AAChBkG,IAAAA,IAAI,CAACO,SAAL,CAAe;AACX3B,MAAAA,IAAI,EAAE,QADK;AAEX9E,MAAAA,MAAM,EAAEsF,OAAO,CAACtF,MAFL;AAGXmG,MAAAA,WAAW,EAAE,KAHF;AAIXtC,MAAAA,KAAK,EAAEyB,OAAO,CAACzB;AAJJ,KAAf;AAMH,GAPD,MAOO,IAAIyB,OAAO,CAACI,OAAZ,EAAqB;AACxBJ,IAAAA,OAAO,CAACI,OAAR,CAAgB7E,OAAhB,CAAwB,UAAUzC,CAAV,EAAa;AACjC8H,MAAAA,IAAI,CAACO,SAAL,CAAerI,CAAf,EAAkBkH,OAAO,CAACzB,KAA1B;AACH,KAFD;AAGH,GAJM,MAIA,IAAI4B,MAAM,IAAIH,OAAO,CAACzB,KAAtB,EAA6B;AAChC,SAAKA,KAAL,CAAWyB,OAAO,CAACzB,KAAnB;AACH,GAFM,MAEA,IAAI,CAAC4B,MAAL,EAAa;AAChB,QAAI1G,UAAU,KAAK,SAAnB,EAA8B;AAC1B;AACZ;AACA;AACA;AACA;AACA;AACA;AACYmH,MAAAA,IAAI,CAACO,SAAL,CAAe;AACX3B,QAAAA,IAAI,EAAE,KADK;AAEX9E,QAAAA,MAAM,EAAE,IAAI2D,gBAAJ,EAFG;AAGXwC,QAAAA,WAAW,EAAE,KAHF;AAIXtC,QAAAA,KAAK,EAAEyB,OAAO,CAACzB;AAJJ,OAAf;AAMH,KAdD,MAcO;AACHqC,MAAAA,IAAI,CAACO,SAAL,CAAe;AACX3B,QAAAA,IAAI,EAAE,QADK;AAEX9E,QAAAA,MAAM,EAAEhB,OAAO,CAAC0H,MAFL;AAGXP,QAAAA,WAAW,EAAE,KAHF;AAIXtC,QAAAA,KAAK,EAAEyB,OAAO,CAACzB;AAJJ,OAAf;AAMH;AACJ;;AACD,MAAIyB,OAAO,CAACK,WAAZ,EAAyB;AACrBO,IAAAA,IAAI,CAACS,cAAL,CAAoBrB,OAAO,CAACK,WAA5B;AACH;;AACD,MAAIL,OAAO,CAACQ,GAAZ,EAAiB;AACb,SAAKA,GAAL,GAAW,IAAX;AACH;;AACD3H,EAAAA,GAAG,CAAC,UAAD,EAAa+H,IAAb,CAAH,CAvJkD,CAyJlD;AACA;AACA;AACA;AACA;;AACA,MAAIH,MAAM,GAAGxF,OAAO,CAAC+E,OAAD,CAApB;AACA,SAAOS,MAAM,CAAC/F,MAAd;AACA,SAAO+F,MAAM,CAAClC,KAAd;AACA,SAAOkC,MAAM,CAACL,OAAd;AACA,SAAOK,MAAM,CAACJ,WAAd;AACA,SAAOI,MAAM,CAACD,GAAd;;AACA,MAAI,KAAKH,WAAT,EAAsB;AAClB,SAAKiB,iBAAL,CAAuBb,MAAvB;AACH;;AACD,MAAI,CAACA,MAAM,CAACtG,QAAR,IAAoB,CAACyG,IAAI,CAACH,MAAL,CAAYtG,QAArC,EAA+C;AAC3CsG,IAAAA,MAAM,CAACtG,QAAP,GAAkBH,EAAE,CAACG,QAAH,EAAlB;AACH;;AACD,MAAI,CAACsG,MAAM,CAACc,GAAZ,EAAiB;AACbd,IAAAA,MAAM,CAACc,GAAP,GAAa7H,OAAO,CAAC6H,GAArB;AACH;;AACDlG,EAAAA,MAAM,CAACC,IAAP,CAAYmF,MAAZ,EAAoBlF,OAApB,CAA4B,UAAUC,CAAV,EAAa;AACrCoF,IAAAA,IAAI,CAACH,MAAL,CAAYjF,CAAZ,IAAiBiF,MAAM,CAACjF,CAAD,CAAvB;AACH,GAFD;AAGH;;AAEDjB,IAAI,CAACiH,QAAL,CAAczB,MAAd,EAAsBtF,YAAtB;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACAsF,MAAM,CAAC7G,SAAP,CAAiBiI,SAAjB,GAA6B,SAASA,SAAT,CAAmBrI,CAAnB,EAAsB2I,YAAtB,EAAoC;AAC7D,MAAIb,IAAI,GAAG,IAAX;;AACA,MAAIa,YAAY,KAAK,IAAjB,IAAyBA,YAAY,KAAK/E,SAA9C,EAAyD;AACrD+E,IAAAA,YAAY,GAAGjD,IAAf;AACH;;AAED1F,EAAAA,CAAC,GAAGmC,OAAO,CAACnC,CAAD,CAAX,CAN6D,CAQ7D;;AACA,MAAI,CAACA,CAAC,CAAC0G,IAAP,EAAa;AACT,QAAI1G,CAAC,CAAC4B,MAAN,EAAc;AACV5B,MAAAA,CAAC,CAAC0G,IAAF,GAAS,QAAT;AACH,KAFD,MAEO,IAAI1G,CAAC,CAAC4I,IAAN,EAAY;AACf5I,MAAAA,CAAC,CAAC0G,IAAF,GAAS,MAAT;AACH;AACJ;;AACD1G,EAAAA,CAAC,CAAC6I,GAAF,GAAS7I,CAAC,CAAC0G,IAAF,KAAW,KAApB,CAhB6D,CAgBhC;;AAE7B,MAAI1G,CAAC,CAACyF,KAAF,KAAY7B,SAAhB,EAA2B;AACvB5D,IAAAA,CAAC,CAACyF,KAAF,GAAUe,YAAY,CAACxG,CAAC,CAACyF,KAAH,CAAtB;AACH,GAFD,MAEO;AACHzF,IAAAA,CAAC,CAACyF,KAAF,GAAUe,YAAY,CAACmC,YAAD,CAAtB;AACH;;AACD,MAAI3I,CAAC,CAACyF,KAAF,GAAUqC,IAAI,CAACL,MAAnB,EAA2B;AACvBK,IAAAA,IAAI,CAACL,MAAL,GAAczH,CAAC,CAACyF,KAAhB;AACH;;AAED,UAAQzF,CAAC,CAAC0G,IAAV;AACA,SAAK,QAAL;AACIhF,MAAAA,MAAM,CAACwD,EAAP,CAAU6B,UAAU,CAAC/G,CAAC,CAAC4B,MAAH,CAApB,EACU,sCAAsCH,IAAI,CAACmB,OAAL,CAAa5C,CAAC,CAAC4B,MAAf,CADhD;;AAGA,UAAI,CAAC5B,CAAC,CAAC+H,WAAP,EAAoB;AAChB/H,QAAAA,CAAC,CAAC+H,WAAF,GAAgB,KAAhB;AACH;;AACD;;AACJ,SAAK,MAAL;AACI,UAAI/H,CAAC,CAAC8I,iBAAF,KAAwBlF,SAA5B,EAAuC;AACnC5D,QAAAA,CAAC,CAAC8I,iBAAF,GAAsB,IAAtB;AACH;;AACD,UAAI,CAAC9I,CAAC,CAAC4B,MAAP,EAAe;AACX5B,QAAAA,CAAC,CAAC4B,MAAF,GAAWT,EAAE,CAAC4H,iBAAH,CAAqB/I,CAAC,CAAC4I,IAAvB,EACqB;AAACI,UAAAA,KAAK,EAAE,GAAR;AAAaC,UAAAA,QAAQ,EAAE;AAAvB,SADrB,CAAX;;AAEA,YAAI,CAACjJ,CAAC,CAAC+H,WAAP,EAAoB;AAChB/H,UAAAA,CAAC,CAAC+H,WAAF,GAAgB,IAAhB;AACH;AACJ,OAND,MAMO;AACH,YAAI,CAAC/H,CAAC,CAAC+H,WAAP,EAAoB;AAChB/H,UAAAA,CAAC,CAAC+H,WAAF,GAAgB,KAAhB;AACH;AACJ;;AACD;;AACJ,SAAK,eAAL;AACIrG,MAAAA,MAAM,CAACwD,EAAP,CAAU,CAAClF,CAAC,CAAC4B,MAAb,EACU,mDADV;AAEAF,MAAAA,MAAM,CAACwD,EAAP,CAAUlF,CAAC,CAAC4I,IAAZ;AACAlH,MAAAA,MAAM,CAACwD,EAAP,CAAUlD,EAAV,EAAc,mDACE,qBADhB;AAEAhC,MAAAA,CAAC,CAAC4B,MAAF,GAAW,IAAIsH,kBAAJ,CAAuBlJ,CAAvB,CAAX;;AACA,UAAI,CAACA,CAAC,CAAC+H,WAAP,EAAoB;AAChB/H,QAAAA,CAAC,CAAC+H,WAAF,GAAgB,IAAhB;AACH;;AACD;;AACJ,SAAK,KAAL;AACI,UAAI,CAAC/H,CAAC,CAAC+H,WAAP,EAAoB;AAChB/H,QAAAA,CAAC,CAAC+H,WAAF,GAAgB,KAAhB;AACH;;AACD;;AACJ;AACI,YAAM,IAAInB,SAAJ,CAAc,0BAA0B5G,CAAC,CAAC0G,IAA5B,GAAmC,GAAjD,CAAN;AA1CJ;;AA6CA,MAAI1G,CAAC,CAAC8I,iBAAF,IAAuB,OAAQ9I,CAAC,CAAC4B,MAAF,CAASuH,EAAjB,KAAyB,UAApD,EAAgE;AAC5D;AACA;AACAnJ,IAAAA,CAAC,CAAC4B,MAAF,CAASuH,EAAT,CAAY,OAAZ,EAAqB,SAASC,aAAT,CAAuBC,GAAvB,EAA4B;AAC7CvB,MAAAA,IAAI,CAACwB,IAAL,CAAU,OAAV,EAAmBD,GAAnB,EAAwBrJ,CAAxB;AACH,KAFD;AAGH;;AAED8H,EAAAA,IAAI,CAACR,OAAL,CAAapE,IAAb,CAAkBlD,CAAlB;AACA,SAAO8H,IAAI,CAACyB,iBAAZ,CAjF6D,CAiF7B;AACnC,CAlFD;AAqFA;AACA;AACA;AACA;AACA;AACA;;;AACAtC,MAAM,CAAC7G,SAAP,CAAiBmI,cAAjB,GAAkC,SAASA,cAAT,CAAwBhB,WAAxB,EAAqC;AACnE,MAAIO,IAAI,GAAG,IAAX;;AAEA,MAAI,CAACA,IAAI,CAACP,WAAV,EAAuB;AACnBO,IAAAA,IAAI,CAACP,WAAL,GAAmB,EAAnB;AACH;;AACDhF,EAAAA,MAAM,CAACC,IAAP,CAAY+E,WAAZ,EAAyB9E,OAAzB,CAAiC,UAAU+G,KAAV,EAAiB;AAC9C,QAAIC,UAAU,GAAGlC,WAAW,CAACiC,KAAD,CAA5B;;AACA,QAAI,OAAQC,UAAR,KAAwB,UAA5B,EAAwC;AACpC,YAAM,IAAI7C,SAAJ,CAAcjE,MAAM,CACtB,uDADsB,EAEtB6G,KAFsB,CAApB,CAAN;AAGH,KAJD,MAIO;AACH1B,MAAAA,IAAI,CAACP,WAAL,CAAiBiC,KAAjB,IAA0BC,UAA1B;AACH;AACJ,GATD;AAUH,CAhBD;AAoBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACAxC,MAAM,CAAC7G,SAAP,CAAiBsJ,KAAjB,GAAyB,UAAUxC,OAAV,EAAmByC,MAAnB,EAA2B;AAChD,SAAO,IAAK,KAAKC,WAAV,CAAuB,IAAvB,EAA6B1C,OAAO,IAAI,EAAxC,EAA4CyC,MAA5C,CAAP;AACH,CAFD;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA1C,MAAM,CAAC7G,SAAP,CAAiByJ,iBAAjB,GAAqC,YAAY;AAC7C,MAAI/B,IAAI,GAAG,IAAX;AACAA,EAAAA,IAAI,CAACR,OAAL,CAAa7E,OAAb,CAAqB,UAAUzC,CAAV,EAAa;AAC9B,QAAIA,CAAC,CAAC0G,IAAF,KAAW,MAAf,EAAuB;AACnB,UAAI1G,CAAC,CAAC4B,MAAN,EAAc;AACV;AACA;AACA5B,QAAAA,CAAC,CAAC4B,MAAF,CAASkI,GAAT;AACA9J,QAAAA,CAAC,CAAC4B,MAAF,CAASmI,WAAT;AACA,eAAO/J,CAAC,CAAC4B,MAAT;AACH;;AACD5B,MAAAA,CAAC,CAAC4B,MAAF,GAAWT,EAAE,CAAC4H,iBAAH,CAAqB/I,CAAC,CAAC4I,IAAvB,EACP;AAACI,QAAAA,KAAK,EAAE,GAAR;AAAaC,QAAAA,QAAQ,EAAE;AAAvB,OADO,CAAX;AAEAjJ,MAAAA,CAAC,CAAC4B,MAAF,CAASuH,EAAT,CAAY,OAAZ,EAAqB,UAAUE,GAAV,EAAe;AAChCvB,QAAAA,IAAI,CAACwB,IAAL,CAAU,OAAV,EAAmBD,GAAnB,EAAwBrJ,CAAxB;AACH,OAFD;AAGH;AACJ,GAfD;AAgBH,CAlBD;AAqBA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACAiH,MAAM,CAAC7G,SAAP,CAAiBqF,KAAjB,GAAyB,SAASA,KAAT,CAAeuE,KAAf,EAAsB;AAC3C,MAAIA,KAAK,KAAKpG,SAAd,EAAyB;AACrB,WAAO,KAAK6D,MAAZ;AACH;;AACD,MAAIwC,QAAQ,GAAGzD,YAAY,CAACwD,KAAD,CAA3B;AACA,MAAI5G,GAAG,GAAG,KAAKkE,OAAL,CAAarE,MAAvB;;AACA,OAAK,IAAID,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGI,GAApB,EAAyBJ,CAAC,EAA1B,EAA8B;AAC1B,SAAKsE,OAAL,CAAatE,CAAb,EAAgByC,KAAhB,GAAwBwE,QAAxB;AACH;;AACD,OAAKxC,MAAL,GAAcwC,QAAd;AACH,CAVD;AAaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACAhD,MAAM,CAAC7G,SAAP,CAAiB8J,MAAjB,GAA0B,SAASA,MAAT,CAAgB7D,IAAhB,EAAsB2D,KAAtB,EAA6B;AACnD,MAAI3D,IAAI,KAAKzC,SAAb,EAAwB;AACpBlC,IAAAA,MAAM,CAACyI,KAAP,CAAaH,KAAb,EAAoBpG,SAApB;AACA,WAAO,KAAK0D,OAAL,CAAa8C,GAAb,CACH,UAAUpK,CAAV,EAAa;AAAE,aAAOA,CAAC,CAACyF,KAAT;AAAgB,KAD5B,CAAP;AAEH;;AACD,MAAI7D,MAAJ;;AACA,MAAI,OAAQyE,IAAR,KAAkB,QAAtB,EAAgC;AAC5BzE,IAAAA,MAAM,GAAG,KAAK0F,OAAL,CAAajB,IAAb,CAAT;;AACA,QAAIzE,MAAM,KAAKgC,SAAf,EAA0B;AACtB,YAAM,IAAI3C,KAAJ,CAAU,2BAA2BoF,IAArC,CAAN;AACH;AACJ,GALD,MAKO;AACH,QAAIjD,GAAG,GAAG,KAAKkE,OAAL,CAAarE,MAAvB;;AACA,SAAK,IAAID,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGI,GAApB,EAAyBJ,CAAC,EAA1B,EAA8B;AAC1B,UAAIhD,CAAC,GAAG,KAAKsH,OAAL,CAAatE,CAAb,CAAR;;AACA,UAAIhD,CAAC,CAACqG,IAAF,KAAWA,IAAf,EAAqB;AACjBzE,QAAAA,MAAM,GAAG5B,CAAT;AACA;AACH;AACJ;;AACD,QAAI,CAAC4B,MAAL,EAAa;AACT,YAAM,IAAIX,KAAJ,CAAU0B,MAAM,CAAC,0BAAD,EAA6B0D,IAA7B,CAAhB,CAAN;AACH;AACJ;;AACD,MAAI2D,KAAK,KAAKpG,SAAd,EAAyB;AACrB,WAAOhC,MAAM,CAAC6D,KAAd;AACH,GAFD,MAEO;AACH,QAAIwE,QAAQ,GAAGzD,YAAY,CAACwD,KAAD,CAA3B;AACApI,IAAAA,MAAM,CAAC6D,KAAP,GAAewE,QAAf;;AACA,QAAIA,QAAQ,GAAG,KAAKxC,MAApB,EAA4B;AACxB,WAAKA,MAAL,GAAcwC,QAAd;AACH;AACJ;AACJ,CAlCD;AAqCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACAhD,MAAM,CAAC7G,SAAP,CAAiBoI,iBAAjB,GAAqC,UAAUb,MAAV,EAAkB0C,aAAlB,EAAiC;AAClE,MAAIvC,IAAI,GAAG,IAAX;AAEA/H,EAAAA,GAAG,CAAC,kCAAD,EAAqCsK,aAArC,CAAH,CAHkE,CAKlE;AACA;;AACA9H,EAAAA,MAAM,CAACC,IAAP,CAAY,KAAK+E,WAAjB,EAA8B9E,OAA9B,CAAsC,UAAU4D,IAAV,EAAgB;AAClD,QAAIsB,MAAM,CAACtB,IAAD,CAAN,KAAiBzC,SAAjB,IACCyG,aAAa,IAAIA,aAAa,CAAChE,IAAD,CADnC,EAEA;AACI;AACH;;AACDtG,IAAAA,GAAG,CAAC,sCAAD,EAAyCsG,IAAzC,CAAH;;AACA,QAAI;AACAsB,MAAAA,MAAM,CAACtB,IAAD,CAAN,GAAeyB,IAAI,CAACP,WAAL,CAAiBlB,IAAjB,EAAuBsB,MAAM,CAACtB,IAAD,CAA7B,CAAf;AACH,KAFD,CAEE,OAAOgD,GAAP,EAAY;AACVtE,MAAAA,KAAK,CAACpC,MAAM,CAAC,mDACP,6DADO,GAEP,kCAFM,EAGR0D,IAHQ,EAGFgD,GAAG,CAACpF,KAAJ,IAAaoF,GAHX,CAAP,CAAL;;AAIA1B,MAAAA,MAAM,CAACtB,IAAD,CAAN,GAAe1D,MAAM,CAAC,0CAChB,uCADe,EAC0B0D,IAD1B,CAArB;AAEH;AACJ,GAjBD;AAkBH,CAzBD;AA4BA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACAY,MAAM,CAAC7G,SAAP,CAAiBkK,KAAjB,GAAyB,UAAU9E,GAAV,EAAe+E,MAAf,EAAuB;AAC5C,MAAIvH,CAAJ,CAD4C,CAG5C;AACA;;AACA,MAAI,KAAKuG,iBAAL,KAA2B3F,SAA/B,EAA0C;AACtC,SAAK2F,iBAAL,GAAyB,KAAzB;;AACA,SAAKvG,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAG,KAAKsE,OAAL,CAAarE,MAA7B,EAAqCD,CAAC,EAAtC,EAA0C;AACtC,UAAI,CAAC,KAAKsE,OAAL,CAAatE,CAAb,EAAgB6F,GAArB,EAA0B;AACtB,aAAKU,iBAAL,GAAyB,IAAzB;AACA;AACH;AACJ;AACJ,GAb2C,CAe5C;;;AACA,MAAIlG,GAAJ;;AACA,MAAIkH,MAAM,IAAI,KAAKhB,iBAAnB,EAAsC;AAClClG,IAAAA,GAAG,GAAGK,wBAAwB,CAAC8B,GAAD,CAAxB,GAAgC,IAAtC;AACH;;AAED,MAAI+E,MAAJ,EACI,OAAOlH,GAAP;AAEJ,MAAIoC,KAAK,GAAGD,GAAG,CAACC,KAAhB;;AACA,OAAKzC,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAG,KAAKsE,OAAL,CAAarE,MAA7B,EAAqCD,CAAC,EAAtC,EAA0C;AACtC,QAAIhD,CAAC,GAAG,KAAKsH,OAAL,CAAatE,CAAb,CAAR;;AACA,QAAIhD,CAAC,CAACyF,KAAF,IAAWA,KAAf,EAAsB;AAClB1F,MAAAA,GAAG,CAAC,oDAAD,EACCyF,GAAG,CAACR,GADL,EACUhF,CAAC,CAAC0G,IADZ,EACkB1G,CAAC,CAACyF,KADpB,EAC2BA,KAD3B,EACkCD,GADlC,CAAH;AAEAxF,MAAAA,CAAC,CAAC4B,MAAF,CAASyD,KAAT,CAAerF,CAAC,CAAC6I,GAAF,GAAQrD,GAAR,GAAcnC,GAA7B;AACH;AACJ;;AAAA;AAED,SAAOA,GAAP;AACH,CAnCD;AAsCA;AACA;AACA;AACA;;;AACA,SAASmH,QAAT,CAAkB7E,GAAlB,EAAuB8E,QAAvB,EAAiCxK,IAAjC,EAAuC;AACnC,MAAIoK,aAAJ,EAAmB1C,MAAnB,EAA2B+C,OAA3B;;AACA,MAAIzK,IAAI,CAAC,CAAD,CAAJ,YAAmBgB,KAAvB,EAA8B;AAC1B;AACA0G,IAAAA,MAAM,GAAG;AACL;AACA0B,MAAAA,GAAG,EAAG1D,GAAG,CAAC4B,WAAJ,IAAmB5B,GAAG,CAAC4B,WAAJ,CAAgB8B,GAAnC,GACA1D,GAAG,CAAC4B,WAAJ,CAAgB8B,GAAhB,CAAoBpJ,IAAI,CAAC,CAAD,CAAxB,CADA,GAEAgH,MAAM,CAAC0D,cAAP,CAAsBtB,GAAtB,CAA0BpJ,IAAI,CAAC,CAAD,CAA9B;AAJD,KAAT;AAMAoK,IAAAA,aAAa,GAAG;AAAChB,MAAAA,GAAG,EAAE;AAAN,KAAhB;;AACA,QAAIpJ,IAAI,CAACgD,MAAL,KAAgB,CAApB,EAAuB;AACnByH,MAAAA,OAAO,GAAG,CAAC/C,MAAM,CAAC0B,GAAP,CAAWuB,OAAZ,CAAV;AACH,KAFD,MAEO;AACHF,MAAAA,OAAO,GAAGzK,IAAI,CAACI,KAAL,CAAW,CAAX,CAAV;AACH;AACJ,GAdD,MAcO,IAAI,yBAAQJ,IAAI,CAAC,CAAD,CAAZ,MAAqB,QAArB,IAAiCE,KAAK,CAACkC,OAAN,CAAcpC,IAAI,CAAC,CAAD,CAAlB,CAArC,EAA6D;AAChE;AACA0H,IAAAA,MAAM,GAAG,IAAT;AACA+C,IAAAA,OAAO,GAAGzK,IAAI,CAACI,KAAL,EAAV;AACH,GAJM,MAIA,IAAIwK,MAAM,CAACC,QAAP,CAAgB7K,IAAI,CAAC,CAAD,CAApB,CAAJ,EAA8B;AAAG;AACpC;AACA;AACA0H,IAAAA,MAAM,GAAG,IAAT;AACA+C,IAAAA,OAAO,GAAGzK,IAAI,CAACI,KAAL,EAAV;AACAqK,IAAAA,OAAO,CAAC,CAAD,CAAP,GAAajJ,IAAI,CAACmB,OAAL,CAAa8H,OAAO,CAAC,CAAD,CAApB,CAAb;AACH,GANM,MAMA;AAAG;AACN/C,IAAAA,MAAM,GAAG1H,IAAI,CAAC,CAAD,CAAb;;AACA,QAAI0H,MAAM,IAAI1H,IAAI,CAACgD,MAAL,KAAgB,CAA1B,IAA+B0E,MAAM,CAAC0B,GAAtC,IACA1B,MAAM,CAAC0B,GAAP,YAAsBpI,KAD1B,EAEA;AACIyJ,MAAAA,OAAO,GAAG,CAAC/C,MAAM,CAAC0B,GAAP,CAAWuB,OAAZ,CAAV;AACH,KAJD,MAIO;AACHF,MAAAA,OAAO,GAAGzK,IAAI,CAACI,KAAL,CAAW,CAAX,CAAV;AACH;AACJ,GAnCkC,CAqCnC;;;AACA,MAAImF,GAAG,GAAGrD,OAAO,CAACwD,GAAG,CAACgC,MAAL,CAAjB;AACA,MAAIlC,KAAK,GAAGD,GAAG,CAACC,KAAJ,GAAYgF,QAAxB;AACA,MAAIM,SAAS,GAAIpD,MAAM,GAAGxF,OAAO,CAACwF,MAAD,CAAV,GAAqB,IAA5C;;AACA,MAAIoD,SAAJ,EAAe;AACX,QAAIpF,GAAG,CAAC4B,WAAR,EAAqB;AACjB5B,MAAAA,GAAG,CAAC6C,iBAAJ,CAAsBuC,SAAtB,EAAiCV,aAAjC;AACH;;AACD9H,IAAAA,MAAM,CAACC,IAAP,CAAYuI,SAAZ,EAAuBtI,OAAvB,CAA+B,UAAUC,CAAV,EAAa;AACxC8C,MAAAA,GAAG,CAAC9C,CAAD,CAAH,GAASqI,SAAS,CAACrI,CAAD,CAAlB;AACH,KAFD;AAGH;;AACD8C,EAAAA,GAAG,CAACR,GAAJ,GAAUrC,MAAM,CAACjC,KAAP,CAAaiF,GAAb,EAAkB+E,OAAlB,CAAV;;AACA,MAAI,CAAClF,GAAG,CAACwF,IAAT,EAAe;AACXxF,IAAAA,GAAG,CAACwF,IAAJ,GAAY,IAAIC,IAAJ,EAAZ;AACH,GApDkC,CAqDnC;;;AACA,MAAItF,GAAG,CAAC+B,GAAJ,IAAW,CAAClC,GAAG,CAACkC,GAApB,EAAyB;AACrBlC,IAAAA,GAAG,CAACkC,GAAJ,GAAU/D,cAAc,EAAxB;AACH;;AACD6B,EAAAA,GAAG,CAAC0F,CAAJ,GAAQpL,WAAR;AAEA,SAAO0F,GAAP;AACH;;AAAA;AAGD;AACA;AACA;AACA;AACA;;AACA,SAAS2F,WAAT,CAAqB9H,GAArB,EAA0BsC,GAA1B,EAA+B8E,QAA/B,EAAyCC,OAAzC,EAAkD;AAC9C,SAAO,CAAErH,GAAG,IAAIsC,GAAG,CAAC2E,KAAJ,CAAUE,QAAQ,CAAC7E,GAAD,EAAM8E,QAAN,EAAgBC,OAAhB,CAAlB,EAA4C,IAA5C,CAAT,CAAP;AACH;AAGD;AACA;AACA;AACA;;;AACA,SAASU,YAAT,CAAsBX,QAAtB,EAAgC;AAC5B,SAAO,YAAY;AACf,QAAI9E,GAAG,GAAG,IAAV;AACA,QAAItC,GAAG,GAAG,IAAV;AACA,QAAImC,GAAG,GAAG,IAAV;;AAEA,QAAI,CAAC,KAAK8E,KAAV,EAAiB;AACb;AACZ;AACA;AACA;AACA;AACA;AACY,UAAIrF,QAAQ,GAAG,SAAf;;AACA,UAAI,CAACK,WAAW,CAACL,QAAD,CAAhB,EAA4B;AACxB,YAAIf,MAAM,GAAGP,cAAc,EAA3B;;AACAoB,QAAAA,KAAK,CAACpC,MAAM,CAAC,+CACP,2CADM,EAERuB,MAAM,CAACE,IAFC,EAEKF,MAAM,CAACI,IAFZ,EAEkB7C,IAAI,CAACmB,OAAL,CAAa,IAAb,CAFlB,CAAP,EAGDqC,QAHC,CAAL;AAIH;;AACD;AACH,KAhBD,MAgBO,IAAI1E,SAAS,CAAC0C,MAAV,KAAqB,CAAzB,EAA4B;AAAI;AACnC,aAAQ,KAAKwE,MAAL,IAAegD,QAAvB;AACH;;AAED,QAAIC,OAAO,GAAG,IAAIvK,KAAJ,CAAUI,SAAS,CAAC0C,MAApB,CAAd;;AACA,SAAK,IAAID,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG0H,OAAO,CAACzH,MAA5B,EAAoC,EAAED,CAAtC,EAAyC;AACrC0H,MAAAA,OAAO,CAAC1H,CAAD,CAAP,GAAazC,SAAS,CAACyC,CAAD,CAAtB;AACH;;AAED,QAAI,KAAKyE,MAAL,IAAegD,QAAnB,EAA6B;AACzBjF,MAAAA,GAAG,GAAGgF,QAAQ,CAAC7E,GAAD,EAAM8E,QAAN,EAAgBC,OAAhB,CAAd;AACArH,MAAAA,GAAG,GAAG,KAAKiH,KAAL,CAAW9E,GAAX,CAAN;AACH;;AAED,QAAIe,MAAJ,EAAY;AACRA,MAAAA,MAAM,CAACkE,QAAD,CAAN,CAAiBY,IAAjB,CAAsBF,WAAtB,EAAmC9H,GAAnC,EAAwCsC,GAAxC,EAA6C8E,QAA7C,EAAuDC,OAAvD;AACH;AACJ,GAtCD;AAuCH;AAGD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACAzD,MAAM,CAAC7G,SAAP,CAAiBkL,KAAjB,GAAyBF,YAAY,CAACpF,KAAD,CAArC;AACAiB,MAAM,CAAC7G,SAAP,CAAiBmL,KAAjB,GAAyBH,YAAY,CAACnF,KAAD,CAArC;AACAgB,MAAM,CAAC7G,SAAP,CAAiByF,IAAjB,GAAwBuF,YAAY,CAAC1F,IAAD,CAApC;AACAuB,MAAM,CAAC7G,SAAP,CAAiB2F,IAAjB,GAAwBqF,YAAY,CAACxF,IAAD,CAApC;AACAqB,MAAM,CAAC7G,SAAP,CAAiBK,KAAjB,GAAyB2K,YAAY,CAACtF,KAAD,CAArC;AACAmB,MAAM,CAAC7G,SAAP,CAAiBoL,KAAjB,GAAyBJ,YAAY,CAAClF,KAAD,CAArC,C,CAIA;AACA;AACA;AACA;;AAEAe,MAAM,CAAC0D,cAAP,GAAwB,EAAxB,C,CAEA;;AACA1D,MAAM,CAAC0D,cAAP,CAAsBc,GAAtB,GAA4B,UAAUA,GAAV,EAAe;AACvC,MAAI,CAACA,GAAD,IAAQ,CAACA,GAAG,CAACC,UAAjB,EACI,OAAOD,GAAP;AACJ,SAAO;AACHE,IAAAA,MAAM,EAAEF,GAAG,CAACE,MADT;AAEHC,IAAAA,GAAG,EAAEH,GAAG,CAACG,GAFN;AAGHC,IAAAA,OAAO,EAAEJ,GAAG,CAACI,OAHV;AAIHC,IAAAA,aAAa,EAAEL,GAAG,CAACC,UAAJ,CAAeI,aAJ3B;AAKHC,IAAAA,UAAU,EAAEN,GAAG,CAACC,UAAJ,CAAeK;AALxB,GAAP,CAHuC,CAUvC;AACA;AACA;AACA;AACA;AACH,CAfD,C,CAiBA;;;AACA9E,MAAM,CAAC0D,cAAP,CAAsBqB,GAAtB,GAA4B,UAAUA,GAAV,EAAe;AACvC,MAAI,CAACA,GAAD,IAAQ,CAACA,GAAG,CAACC,UAAjB,EACI,OAAOD,GAAP;AACJ,SAAO;AACHC,IAAAA,UAAU,EAAED,GAAG,CAACC,UADb;AAEHC,IAAAA,MAAM,EAAEF,GAAG,CAACG;AAFT,GAAP;AAIH,CAPD;AAUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASC,iBAAT,CAA2BC,EAA3B,EACA;AACI,MAAIC,GAAG,GAAGD,EAAE,CAACpI,KAAH,IAAYoI,EAAE,CAACE,QAAH,EAAtB;;AACA,MAAIF,EAAE,CAACG,KAAH,IAAY,OAAQH,EAAE,CAACG,KAAX,KAAsB,UAAtC,EAAkD;AAC9C,QAAIC,GAAG,GAAGJ,EAAE,CAACG,KAAH,EAAV;;AACA,QAAIC,GAAJ,EAAS;AACLH,MAAAA,GAAG,IAAI,kBAAkBF,iBAAiB,CAACK,GAAD,CAA1C;AACH;AACJ;;AACD,SAAQH,GAAR;AACH,C,CAED;AACA;;;AACA,IAAII,aAAa,GAAGzF,MAAM,CAAC0D,cAAP,CAAsBtB,GAAtB,GAA4B,UAAUA,GAAV,EAAe;AAC3D,MAAI,CAACA,GAAD,IAAQ,CAACA,GAAG,CAACpF,KAAjB,EACI,OAAOoF,GAAP;AACJ,MAAIjH,GAAG,GAAG;AACNwI,IAAAA,OAAO,EAAEvB,GAAG,CAACuB,OADP;AAENvE,IAAAA,IAAI,EAAEgD,GAAG,CAAChD,IAFJ;AAGNpC,IAAAA,KAAK,EAAEmI,iBAAiB,CAAC/C,GAAD,CAHlB;AAINsD,IAAAA,IAAI,EAAEtD,GAAG,CAACsD,IAJJ;AAKNC,IAAAA,MAAM,EAAEvD,GAAG,CAACuD;AALN,GAAV;AAOA,SAAOxK,GAAP;AACH,CAXD,C,CAcA;;;AACA,SAASyK,aAAT,GAAyB;AACrB,MAAIC,IAAI,GAAG,IAAIC,GAAJ,EAAX;AACA,SAAO,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AACvB,QAAI,CAACA,GAAD,IAAQ,yBAAQA,GAAR,MAAiB,QAA7B,EAAuC;AACnC,aAAOA,GAAP;AACH;;AACD,QAAIH,IAAI,CAACI,GAAL,CAASD,GAAT,CAAJ,EAAmB;AACf,aAAO,YAAP;AACH;;AACDH,IAAAA,IAAI,CAACK,GAAL,CAASF,GAAT;AACA,WAAOA,GAAP;AACH,GATD;AAUH;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASG,eAAT,GAA2B;AACvB,MAAIN,IAAI,GAAG,EAAX;AACA,SAAO,UAAUE,GAAV,EAAeC,GAAf,EAAoB;AACvB,QAAI,CAACA,GAAD,IAAQ,yBAAQA,GAAR,MAAiB,QAA7B,EAAuC;AACnC,aAAOA,GAAP;AACH;;AACD,QAAIH,IAAI,CAACO,OAAL,CAAaJ,GAAb,MAAsB,CAAC,CAA3B,EAA8B;AAC1B,aAAO,YAAP;AACH;;AACDH,IAAAA,IAAI,CAAC5J,IAAL,CAAU+J,GAAV;AACA,WAAOA,GAAP;AACH,GATD;AAUH;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,IAAIK,UAAU,GAAG,OAAQP,GAAR,KAAiB,WAAjB,GAA+BF,aAA/B,GAA+CO,eAAhE;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,SAAS1J,wBAAT,CAAkC8B,GAAlC,EAAuC;AACnC,MAAI;AACA,WAAO+H,IAAI,CAACC,SAAL,CAAehI,GAAf,CAAP;AACH,GAFD,CAEE,OAAO6G,EAAP,EAAW;AACT,QAAI;AACA,aAAOkB,IAAI,CAACC,SAAL,CAAehI,GAAf,EAAoB8H,UAAU,EAA9B,CAAP;AACH,KAFD,CAEE,OAAOG,CAAP,EAAU;AACR,UAAI5L,iBAAJ,EAAuB;AACnB,eAAOA,iBAAiB,CAAC2D,GAAD,CAAxB;AACH,OAFD,MAEO;AACH,YAAIP,QAAQ,GAAGwI,CAAC,CAACxJ,KAAF,CAAQa,KAAR,CAAc,KAAd,EAAqB,CAArB,EAAwB3B,IAAxB,CAA6B,IAA7B,CAAf;;AACA4B,QAAAA,KAAK,CAAC,iCACA,6CADA,GAEA,uDAFA,GAGA,qCAHA,GAIAJ,OAAO,CAAChC,MAAM,CAAC,QAAD,EAAWlB,IAAI,CAACmB,OAAL,CAAa4C,GAAb,CAAX,EAA8BiI,CAAC,CAACxJ,KAAhC,CAAP,CAJR,EAKDgB,QALC,CAAL;;AAMA,eAAOtC,MAAM,CAAC,4CACR,0BADO,EACqB8K,CAAC,CAAC7C,OADvB,CAAb;AAEH;AACJ;AACJ;AACJ;;AAGD,IAAI1B,kBAAkB,GAAG,IAAzB;;AACA,IAAIlH,EAAJ,EAAQ;AAERkH,EAAAA,kBAAkB,GAAG,SAASA,kBAAT,CAA4BhC,OAA5B,EAAqC;AACtD,SAAK0B,IAAL,GAAY1B,OAAO,CAAC0B,IAApB;AAEA,SAAK8E,KAAL,GAAcxG,OAAO,CAACwG,KAAR,IAAiB,IAAjB,GAAwB,EAAxB,GAA6BxG,OAAO,CAACwG,KAAnD;AACAhM,IAAAA,MAAM,CAACyI,KAAP,0BAAqB,KAAKuD,KAA1B,GAAkC,QAAlC,EACI/K,MAAM,CAAC,6DAAD,EACF,KAAK+K,KADH,2BACkB,KAAKA,KADvB,GAC+B,IAD/B,CADV;AAGAhM,IAAAA,MAAM,CAACwD,EAAP,CAAU,KAAKwI,KAAL,IAAc,CAAxB,EACI/K,MAAM,CAAC,oDAAD,EACF,KAAK+K,KADH,EACU,IADV,CADV,EAPsD,CAWtD;;AACA,QAAIxG,OAAO,CAACyG,MAAZ,EAAoB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAIA,MAAM,GAAG;AACT,kBAAU,IADD;AAET,iBAAS,IAFA;AAGT,kBAAU,IAHD;AAIT,mBAAW,IAJF;AAKT,kBAAU;AALD,QAMXzG,OAAO,CAACyG,MANG,KAMQzG,OAAO,CAACyG,MAN7B;AAOA,UAAIC,CAAC,GAAG,8BAA8BC,IAA9B,CAAmCF,MAAnC,CAAR;;AACA,UAAI,CAACC,CAAL,EAAQ;AACJ,cAAM,IAAI3M,KAAJ,CAAU0B,MAAM,CAAC,sBAAD,EAAyBuE,OAAO,CAACyG,MAAjC,CAAhB,CAAN;AACH;;AACD,WAAKG,SAAL,GAAiBrK,MAAM,CAACmK,CAAC,CAAC,CAAD,CAAF,CAAvB;AACA,WAAKG,WAAL,GAAmBH,CAAC,CAAC,CAAD,CAApB;AACH,KAtBD,MAsBO;AACH,WAAKE,SAAL,GAAiB,CAAjB;AACA,WAAKC,WAAL,GAAmB,GAAnB;AACH;;AAED,QAAIC,YAAY,GAAG,IAAnB;;AACA,QAAI;AACA,UAAIC,QAAQ,GAAG9M,EAAE,CAAC+M,QAAH,CAAY,KAAKtF,IAAjB,CAAf;AACAoF,MAAAA,YAAY,GAAGC,QAAQ,CAACE,KAAT,CAAeC,OAAf,EAAf;AACH,KAHD,CAIA,OAAO/E,GAAP,EAAY,CACR;AACH;;AACD,QAAIgF,eAAe,GAAG,KAAtB;;AACA,QAAIL,YAAJ,EAAkB;AACd,UAAIM,WAAW,GAAG,KAAKC,YAAL,CAAkB,CAAlB,CAAlB;;AACA,UAAIP,YAAY,GAAGM,WAAnB,EAAgC;AAC5BD,QAAAA,eAAe,GAAG,IAAlB;AACH;AACJ,KArDqD,CAuDtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA,SAAKzM,MAAL,GAAcT,EAAE,CAAC4H,iBAAH,CAAqB,KAAKH,IAA1B,EACV;AAACI,MAAAA,KAAK,EAAE,GAAR;AAAaC,MAAAA,QAAQ,EAAE;AAAvB,KADU,CAAd;AAGA,SAAKuF,QAAL,GAAgB,EAAhB;AACA,SAAKC,QAAL,GAAgB,KAAhB;;AACA,QAAIJ,eAAJ,EAAqB;AACjB,WAAKK,MAAL,CAAY,kCAAZ;;AACA,WAAKC,MAAL;AACH,KAHD,MAGO;AACH,WAAKC,aAAL;AACH;AACJ,GAlFD;;AAoFAnN,EAAAA,IAAI,CAACiH,QAAL,CAAcQ,kBAAd,EAAkCvH,YAAlC;;AAEAuH,EAAAA,kBAAkB,CAAC9I,SAAnB,CAA6BsO,MAA7B,GAAsC,YAAY;AAC9C;AACA,QAAI,KAAJ,EAAW;AACP,UAAInO,SAAS,CAAC0C,MAAV,KAAqB,CAAzB,EAA4B;AACxB,eAAO,IAAP;AACH;;AACD,UAAIhD,IAAI,GAAGE,KAAK,CAACC,SAAN,CAAgBC,KAAhB,CAAsBC,IAAtB,CAA2BC,SAA3B,CAAX;AACAN,MAAAA,IAAI,CAAC,CAAD,CAAJ,GAAU,MAAO,IAAIgL,IAAJ,GAAW4D,WAAX,EAAP,GAAmC,IAAnC,GACJ,KAAKjG,IADD,GACQ,IADR,GACe3I,IAAI,CAAC,CAAD,CAD7B;AAEAO,MAAAA,OAAO,CAACmF,GAAR,CAAYjF,KAAZ,CAAkB,IAAlB,EAAwBT,IAAxB;AACH,KARD,MAQO;AACH,aAAO,KAAP;AACH;AACJ,GAbD;;AAeAiJ,EAAAA,kBAAkB,CAAC9I,SAAnB,CAA6BwO,aAA7B,GAA6C,YAAY;AACrD,SAAKE,KAAL,GAAa,KAAKP,YAAL,CAAkB,CAAlB,CAAb;;AACA,SAAKQ,iBAAL;AACH,GAHD;;AAKA7F,EAAAA,kBAAkB,CAAC9I,SAAnB,CAA6B2O,iBAA7B,GAAiD,YAAY;AACzD,QAAIjH,IAAI,GAAG,IAAX;AACA,QAAIkH,KAAK,GAAG,KAAKF,KAAL,GAAa7D,IAAI,CAACgE,GAAL,EAAzB,CAFyD,CAGzD;AACA;;AACA,QAAIC,WAAW,GAAG,UAAlB,CALyD,CAK3B;;AAC9B,QAAIF,KAAK,GAAGE,WAAZ,EAAyB;AACrBF,MAAAA,KAAK,GAAGE,WAAR;AACH;;AACD,SAAKC,OAAL,GAAeC,UAAU,CACrB,YAAY;AACRtH,MAAAA,IAAI,CAAC4G,MAAL,CAAY,4CAAZ;;AACA5G,MAAAA,IAAI,CAAC6G,MAAL;AACH,KAJoB,EAKrBK,KALqB,CAAzB;;AAMA,QAAI,OAAQ,KAAKG,OAAL,CAAaE,KAArB,KAAgC,UAApC,EAAgD;AAC5C,WAAKF,OAAL,CAAaE,KAAb;AACH;AACJ,GAlBD;;AAoBAnG,EAAAA,kBAAkB,CAAC9I,SAAnB,CAA6BmO,YAA7B,GACA,SAASA,YAAT,CAAsBe,YAAtB,EAAoC;AAChC,SAAKZ,MAAL,CAAY,oBAAZ,EAAkC,KAAKZ,SAAvC,EAAkD,KAAKC,WAAvD;;AACA,QAAIwB,CAAC,GAAG,IAAItE,IAAJ,EAAR;;AAEA,SAAKyD,MAAL,CAAY,iBAAZ,EAA+Ba,CAA/B;;AACA,SAAKb,MAAL,CAAY,iBAAZ,EAA+Ba,CAAC,CAACV,WAAF,EAA/B;;AACA,QAAIC,KAAJ;;AACA,YAAQ,KAAKf,WAAb;AACA,WAAK,IAAL;AACI;AACA,YAAI,KAAKe,KAAT,EAAgB;AACZA,UAAAA,KAAK,GAAG,KAAKA,KAAL,GAAa,KAAKhB,SAAL,GAAiBwB,YAAtC;AACH,SAFD,MAEO;AACHR,UAAAA,KAAK,GAAG7D,IAAI,CAACgE,GAAL,KAAa,KAAKnB,SAAL,GAAiBwB,YAAtC;AACH;;AACD;;AACJ,WAAK,GAAL;AACI,YAAI,KAAKR,KAAT,EAAgB;AACZA,UAAAA,KAAK,GAAG,KAAKA,KAAL,GAAa,KAAKhB,SAAL,GAAiB,EAAjB,GAAsB,EAAtB,GAA2B,IAA3B,GAAkCwB,YAAvD;AACH,SAFD,MAEO;AACH;AACAR,UAAAA,KAAK,GAAG7D,IAAI,CAACuE,GAAL,CAASD,CAAC,CAACE,cAAF,EAAT,EAA6BF,CAAC,CAACG,WAAF,EAA7B,EACJH,CAAC,CAACI,UAAF,EADI,EACYJ,CAAC,CAACK,WAAF,KAAkBN,YAD9B,CAAR;AAEH;;AACD;;AACJ,WAAK,GAAL;AACI,YAAI,KAAKR,KAAT,EAAgB;AACZA,UAAAA,KAAK,GAAG,KAAKA,KAAL,GAAa,KAAKhB,SAAL,GAAiB,EAAjB,GAAsB,EAAtB,GAA2B,EAA3B,GAAgC,IAAhC,GACfwB,YADN;AAEH,SAHD,MAGO;AACH;AACAR,UAAAA,KAAK,GAAG7D,IAAI,CAACuE,GAAL,CAASD,CAAC,CAACE,cAAF,EAAT,EAA6BF,CAAC,CAACG,WAAF,EAA7B,EACJH,CAAC,CAACI,UAAF,KAAiBL,YADb,CAAR;AAEH;;AACD;;AACJ,WAAK,GAAL;AACI;AACA,YAAI,KAAKR,KAAT,EAAgB;AACZA,UAAAA,KAAK,GAAG,KAAKA,KAAL,GAAa,KAAKhB,SAAL,GAAiB,CAAjB,GAAqB,EAArB,GAA0B,EAA1B,GAA+B,EAA/B,GAAoC,IAApC,GACfwB,YADN;AAEH,SAHD,MAGO;AACH;AACA,cAAIO,SAAS,GAAI,IAAIN,CAAC,CAACO,SAAF,EAArB;;AACA,cAAIR,YAAY,GAAG,CAAnB,EAAsB;AAClBO,YAAAA,SAAS,GAAG,CAACN,CAAC,CAACO,SAAF,EAAb;AACH;;AACD,cAAIR,YAAY,GAAG,CAAf,IAAoBA,YAAY,GAAG,CAAC,CAAxC,EAA2C;AACvCO,YAAAA,SAAS,IAAI,IAAIP,YAAjB;AACH;;AACDR,UAAAA,KAAK,GAAG7D,IAAI,CAACuE,GAAL,CAASD,CAAC,CAACE,cAAF,EAAT,EAA6BF,CAAC,CAACG,WAAF,EAA7B,EACJH,CAAC,CAACI,UAAF,KAAiBE,SADb,CAAR;AAEH;;AACD;;AACJ,WAAK,GAAL;AACI,YAAI,KAAKf,KAAT,EAAgB;AACZA,UAAAA,KAAK,GAAG7D,IAAI,CAACuE,GAAL,CAASD,CAAC,CAACE,cAAF,EAAT,EACJF,CAAC,CAACG,WAAF,KAAkB,KAAK5B,SAAL,GAAiBwB,YAD/B,EAC6C,CAD7C,CAAR;AAEH,SAHD,MAGO;AACH;AACAR,UAAAA,KAAK,GAAG7D,IAAI,CAACuE,GAAL,CAASD,CAAC,CAACE,cAAF,EAAT,EACJF,CAAC,CAACG,WAAF,KAAkBJ,YADd,EAC4B,CAD5B,CAAR;AAEH;;AACD;;AACJ,WAAK,GAAL;AACI,YAAI,KAAKR,KAAT,EAAgB;AACZA,UAAAA,KAAK,GAAG7D,IAAI,CAACuE,GAAL,CAASD,CAAC,CAACE,cAAF,KAAqB,KAAK3B,SAAL,GAAiBwB,YAA/C,EACJ,CADI,EACD,CADC,CAAR;AAEH,SAHD,MAGO;AACH;AACAR,UAAAA,KAAK,GAAG7D,IAAI,CAACuE,GAAL,CAASD,CAAC,CAACE,cAAF,KAAqBH,YAA9B,EAA4C,CAA5C,EAA+C,CAA/C,CAAR;AACH;;AACD;;AACJ;AACI5N,QAAAA,MAAM,CAACqO,IAAP,CAAYpN,MAAM,CAAC,4BAAD,EAA+B,KAAKoL,WAApC,CAAlB;AAlEJ;;AAqEA,QAAI,KAAKW,MAAL,EAAJ,EAAmB;AACf,WAAKA,MAAL,CAAY,2BAAZ,EAAyCI,KAAzC,EACI,IAAI7D,IAAJ,CAAS6D,KAAT,EAAgBkB,WAAhB,EADJ;;AAEA,UAAIf,GAAG,GAAGhE,IAAI,CAACgE,GAAL,EAAV;;AACA,WAAKP,MAAL,CAAY,8CAAZ,EACIO,GADJ,EAEIH,KAAK,GAAGG,GAFZ,EAGI,CAACH,KAAK,GAACG,GAAP,IAAY,IAAZ,GAAiB,EAHrB,EAII,CAACH,KAAK,GAACG,GAAP,IAAY,IAAZ,GAAiB,EAAjB,GAAoB,EAJxB;AAKH;;AACD,WAAOH,KAAP;AACH,GAxFD;;AA0FA5F,EAAAA,kBAAkB,CAAC9I,SAAnB,CAA6BuO,MAA7B,GAAsC,SAASA,MAAT,GAAkB;AACpD;AACA,QAAI7G,IAAI,GAAG,IAAX,CAFoD,CAIpD;AACA;;AACA,QAAIA,IAAI,CAACgH,KAAL,IAAchH,IAAI,CAACgH,KAAL,GAAa7D,IAAI,CAACgE,GAAL,EAA/B,EAA2C;AACvC,aAAOnH,IAAI,CAACiH,iBAAL,EAAP;AACH;;AAED,SAAKL,MAAL,CAAY,QAAZ;;AACA,QAAI5G,IAAI,CAAC2G,QAAT,EAAmB;AACf,YAAM,IAAI7H,SAAJ,CAAc,+CAAd,CAAN;AACH;;AACDkB,IAAAA,IAAI,CAAC2G,QAAL,GAAgB,IAAhB;AAEA3G,IAAAA,IAAI,CAAClG,MAAL,CAAYkI,GAAZ,GAhBoD,CAgBhC;;AAEpB,aAASmG,GAAT,GAAe;AACX,UAAIC,KAAK,GAAGpI,IAAI,CAACc,IAAL,GAAY,GAAZ,GAAkBtF,MAAM,CAAC6M,CAAC,GAAG,CAAL,CAApC;;AACA,UAAIA,CAAC,KAAK,CAAV,EAAa;AACTD,QAAAA,KAAK,GAAGpI,IAAI,CAACc,IAAb;AACH;;AACDuH,MAAAA,CAAC,IAAI,CAAL;;AACArI,MAAAA,IAAI,CAAC4G,MAAL,CAAY,SAAZ,EAAuBwB,KAAvB;;AACA/O,MAAAA,EAAE,CAACiP,MAAH,CAAUF,KAAV,EAAiB,UAAUG,MAAV,EAAkB;AAC/B;AACAC,QAAAA,KAAK;AACR,OAHD;AAIH;;AAED,aAASA,KAAT,GAAiB;AACb,UAAIxI,IAAI,CAAC4F,KAAL,KAAe,CAAf,IAAoByC,CAAC,GAAG,CAA5B,EAA+B;AAC3B,eAAOI,MAAM,EAAb;AACH;;AACD,UAAIC,MAAM,GAAG1I,IAAI,CAACc,IAAlB;AACA,UAAI6H,KAAK,GAAG3I,IAAI,CAACc,IAAL,GAAY,GAAZ,GAAkBtF,MAAM,CAAC6M,CAAD,CAApC;;AACA,UAAIA,CAAC,GAAG,CAAR,EAAW;AACPK,QAAAA,MAAM,IAAI,MAAMlN,MAAM,CAAC6M,CAAC,GAAG,CAAL,CAAtB;AACH;;AACDA,MAAAA,CAAC,IAAI,CAAL;AACAhP,MAAAA,EAAE,CAACuP,MAAH,CAAUF,MAAV,EAAkB,UAAUE,MAAV,EAAkB;AAChC,YAAI,CAACA,MAAL,EAAa;AACTJ,UAAAA,KAAK;AACR,SAFD,MAEO;AACHxI,UAAAA,IAAI,CAAC4G,MAAL,CAAY,YAAZ,EAA0B8B,MAA1B,EAAkCC,KAAlC;;AACAzO,UAAAA,EAAE,CAACwO,MAAD,EAASC,KAAT,EAAgB,UAAUE,KAAV,EAAiB;AAC/B,gBAAIA,KAAJ,EAAW;AACP7I,cAAAA,IAAI,CAACwB,IAAL,CAAU,OAAV,EAAmBqH,KAAnB;AACAJ,cAAAA,MAAM,GAFC,CAEG;AACb,aAHD,MAGO;AACHD,cAAAA,KAAK;AACR;AACJ,WAPC,CAAF;AAQH;AACJ,OAdD;AAeH;;AAED,aAASC,MAAT,GAAkB;AACdzI,MAAAA,IAAI,CAAC4G,MAAL,CAAY,WAAZ,EAAyB5G,IAAI,CAACc,IAA9B;;AACAd,MAAAA,IAAI,CAAClG,MAAL,GAAcT,EAAE,CAAC4H,iBAAH,CAAqBjB,IAAI,CAACc,IAA1B,EACV;AAACI,QAAAA,KAAK,EAAE,GAAR;AAAaC,QAAAA,QAAQ,EAAE;AAAvB,OADU,CAAd;AAEA,UAAI2H,CAAC,GAAG9I,IAAI,CAAC0G,QAAb;AAAA,UAAuBpL,GAAG,GAAGwN,CAAC,CAAC3N,MAA/B;;AACA,WAAK,IAAID,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGI,GAApB,EAAyBJ,CAAC,EAA1B,EAA8B;AAC1B8E,QAAAA,IAAI,CAAClG,MAAL,CAAYyD,KAAZ,CAAkBuL,CAAC,CAAC5N,CAAD,CAAnB;AACH;;AACD8E,MAAAA,IAAI,CAAC0G,QAAL,GAAgB,EAAhB;AACA1G,MAAAA,IAAI,CAAC2G,QAAL,GAAgB,KAAhB;AACA3G,MAAAA,IAAI,CAACwB,IAAL,CAAU,OAAV;;AACAxB,MAAAA,IAAI,CAAC8G,aAAL;AACH;;AAED,QAAIuB,CAAC,GAAG,KAAKzC,KAAb;AACAuC,IAAAA,GAAG;AACN,GA1ED;;AA4EA/G,EAAAA,kBAAkB,CAAC9I,SAAnB,CAA6BiF,KAA7B,GAAqC,SAASA,KAAT,CAAerF,CAAf,EAAkB;AACnD,QAAI,KAAKyO,QAAT,EAAmB;AACf,WAAKD,QAAL,CAActL,IAAd,CAAmBlD,CAAnB;AACA,aAAO,KAAP;AACH,KAHD,MAGO;AACH,aAAO,KAAK4B,MAAL,CAAYyD,KAAZ,CAAkBrF,CAAlB,CAAP;AACH;AACJ,GAPD;;AASAkJ,EAAAA,kBAAkB,CAAC9I,SAAnB,CAA6B0J,GAA7B,GAAmC,SAASA,GAAT,CAAa9J,CAAb,EAAgB;AAC/C,SAAK4B,MAAL,CAAYkI,GAAZ;AACH,GAFD;;AAIAZ,EAAAA,kBAAkB,CAAC9I,SAAnB,CAA6ByQ,OAA7B,GAAuC,SAASA,OAAT,CAAiB7Q,CAAjB,EAAoB;AACvD,SAAK4B,MAAL,CAAYiP,OAAZ;AACH,GAFD;;AAIA3H,EAAAA,kBAAkB,CAAC9I,SAAnB,CAA6B2J,WAA7B,GAA2C,SAASA,WAAT,CAAqB/J,CAArB,EAAwB;AAC/D,SAAK4B,MAAL,CAAYmI,WAAZ;AACH,GAFD;AAIC;AAAC;;AAIF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAAS+G,UAAT,CAAoB5J,OAApB,EAA6B;AACzB,OAAK6J,KAAL,GAAa7J,OAAO,IAAIA,OAAO,CAAC6J,KAAnB,GAA2B7J,OAAO,CAAC6J,KAAnC,GAA2C,GAAxD;AACA,OAAKC,QAAL,GAAgB,IAAhB;AACA,OAAKC,OAAL,GAAe,EAAf;AACAtP,EAAAA,YAAY,CAACrB,IAAb,CAAkB,IAAlB;AACH;;AAEDmB,IAAI,CAACiH,QAAL,CAAcoI,UAAd,EAA0BnP,YAA1B;;AAEAmP,UAAU,CAAC1Q,SAAX,CAAqBiF,KAArB,GAA6B,UAAU6L,MAAV,EAAkB;AAC3C,MAAI,CAAC,KAAKF,QAAV,EACI,MAAO,IAAI/P,KAAJ,CAAU,mCAAV,CAAP;AAEJ,OAAKgQ,OAAL,CAAa/N,IAAb,CAAkBgO,MAAlB;AAEA,MAAI,KAAKD,OAAL,CAAahO,MAAb,GAAsB,KAAK8N,KAA/B,EACI,KAAKE,OAAL,CAAaE,KAAb;AAEJ,SAAQ,IAAR;AACH,CAVD;;AAYAL,UAAU,CAAC1Q,SAAX,CAAqB0J,GAArB,GAA2B,YAAY;AACnC,MAAIvJ,SAAS,CAAC0C,MAAV,GAAmB,CAAvB,EACI,KAAKoC,KAAL,CAAW3E,KAAX,CAAiB,IAAjB,EAAuBP,KAAK,CAACC,SAAN,CAAgBC,KAAhB,CAAsBC,IAAtB,CAA2BC,SAA3B,CAAvB;AACJ,OAAKyQ,QAAL,GAAgB,KAAhB;AACH,CAJD;;AAMAF,UAAU,CAAC1Q,SAAX,CAAqByQ,OAArB,GAA+B,YAAY;AACvC,OAAKG,QAAL,GAAgB,KAAhB;AACA,OAAK1H,IAAL,CAAU,OAAV;AACH,CAHD;;AAKAwH,UAAU,CAAC1Q,SAAX,CAAqB2J,WAArB,GAAmC,YAAY;AAC3C,OAAK8G,OAAL;AACH,CAFD,C,CAKA;;;AAEAO,MAAM,CAACC,OAAP,GAAiBpK,MAAjB;AAEAmK,MAAM,CAACC,OAAP,CAAerL,KAAf,GAAuBA,KAAvB;AACAoL,MAAM,CAACC,OAAP,CAAepL,KAAf,GAAuBA,KAAvB;AACAmL,MAAM,CAACC,OAAP,CAAe3L,IAAf,GAAsBA,IAAtB;AACA0L,MAAM,CAACC,OAAP,CAAezL,IAAf,GAAsBA,IAAtB;AACAwL,MAAM,CAACC,OAAP,CAAevL,KAAf,GAAuBA,KAAvB;AACAsL,MAAM,CAACC,OAAP,CAAenL,KAAf,GAAuBA,KAAvB;AACAkL,MAAM,CAACC,OAAP,CAAe7K,YAAf,GAA8BA,YAA9B;AACA4K,MAAM,CAACC,OAAP,CAAelL,aAAf,GAA+BA,aAA/B;AACAiL,MAAM,CAACC,OAAP,CAAejL,aAAf,GAA+BA,aAA/B,C,CAEA;;AACAgL,MAAM,CAACC,OAAP,CAAeC,OAAf,GAAyB,WAAzB;AACAF,MAAM,CAACC,OAAP,CAAevR,WAAf,GAA6BA,WAA7B;;AAEAsR,MAAM,CAACC,OAAP,CAAeE,YAAf,GAA8B,SAASA,YAAT,CAAsBrK,OAAtB,EAA+B;AACzD,SAAO,IAAID,MAAJ,CAAWC,OAAX,CAAP;AACH,CAFD;;AAIAkK,MAAM,CAACC,OAAP,CAAeP,UAAf,GAA4BA,UAA5B;AACAM,MAAM,CAACC,OAAP,CAAenI,kBAAf,GAAoCA,kBAApC,C,CAEA;AACA;AACA;;AACAkI,MAAM,CAACC,OAAP,CAAe/D,UAAf,GAA4BA,UAA5B","sourcesContent":["/**\n * Copyright (c) 2017 Trent Mick.\n * Copyright (c) 2017 Joyent Inc.\n *\n * The bunyan logging library for node.js.\n *\n * -*- mode: js -*-\n * vim: expandtab:ts=4:sw=4\n */\n\n/*\n * Bunyan log format version. This becomes the 'v' field on all log records.\n * This will be incremented if there is any backward incompatible change to\n * the log record format. Details will be in 'CHANGES.md' (the change log).\n */\n\nvar LOG_VERSION = 0;\n\n\nvar xxx = function xxx(s) {     // internal dev/debug logging\n    var args = ['XX' + 'X: '+s].concat(\n        Array.prototype.slice.call(arguments, 1));\n    console.error.apply(this, args);\n};\nvar xxx = function xxx() {};  // comment out to turn on debug logging\n\n\n/*\n * Runtime environment notes:\n *\n * Bunyan is intended to run in a number of runtime environments. Here are\n * some notes on differences for those envs and how the code copes.\n *\n * - node.js: The primary target environment.\n * - NW.js: http://nwjs.io/  An *app* environment that feels like both a\n *   node env -- it has node-like globals (`process`, `global`) and\n *   browser-like globals (`window`, `navigator`). My *understanding* is that\n *   bunyan can operate as if this is vanilla node.js.\n * - browser: Failing the above, we sniff using the `window` global\n *   <https://developer.mozilla.org/en-US/docs/Web/API/Window/window>.\n *      - browserify: http://browserify.org/  A browser-targetting bundler of\n *        node.js deps. The runtime is a browser env, so can't use fs access,\n *        etc. Browserify's build looks for `require(<single-string>)` imports\n *        to bundle. For some imports it won't be able to handle, we \"hide\"\n *        from browserify with `require('frobshizzle' + '')`.\n * - Other? Please open issues if things are broken.\n */\nvar runtimeEnv;\nif (typeof (process) !== 'undefined' && process.versions) {\n    if (process.versions.nw) {\n        runtimeEnv = 'nw';\n    } else if (process.versions.node) {\n        runtimeEnv = 'node';\n    }\n}\nif (!runtimeEnv && typeof (window) !== 'undefined' &&\n    window.window === window) {\n    runtimeEnv = 'browser';\n}\nif (!runtimeEnv) {\n    throw new Error('unknown runtime environment');\n}\n\n\nvar os, fs, dtrace;\nif (runtimeEnv === 'browser') {\n    os = {\n        hostname: function () {\n            return window.location.host;\n        }\n    };\n    fs = {};\n    dtrace = null;\n} else {\n    os = require('os');\n    fs = require('fs');\n    // try {\n    //     dtrace = require('dtrace-provider' + '');\n    // } catch (e) {\n        dtrace = null;\n    // }\n}\nvar util = require('util');\nvar assert = require('assert');\nvar EventEmitter = require('events').EventEmitter;\nvar stream = require('stream');\n\n// try {\n//     var safeJsonStringify = require('safe-json-stringify');\n// } catch (e) {\n    var safeJsonStringify = null;\n// }\nif (process.env.BUNYAN_TEST_NO_SAFE_JSON_STRINGIFY) {\n    safeJsonStringify = null;\n}\n\n// The 'mv' module is required for rotating-file stream support.\n// try {\n//     var mv = require('mv' + '');\n// } catch (e) {\n    var mv = null;\n// }\n\ntry {\n    var sourceMapSupport = require('source-map-support' + '');\n} catch (_) {\n    sourceMapSupport = null;\n}\n\n\n//---- Internal support stuff\n\n/**\n * A shallow copy of an object. Bunyan logging attempts to never cause\n * exceptions, so this function attempts to handle non-objects gracefully.\n */\nfunction objCopy(obj) {\n    if (obj == null) {  // null or undefined\n        return obj;\n    } else if (Array.isArray(obj)) {\n        return obj.slice();\n    } else if (typeof (obj) === 'object') {\n        var copy = {};\n        Object.keys(obj).forEach(function (k) {\n            copy[k] = obj[k];\n        });\n        return copy;\n    } else {\n        return obj;\n    }\n}\n\nvar format = util.format;\nif (!format) {\n    // If node < 0.6, then use its `util.format`:\n    // <https://github.com/joyent/node/blob/master/lib/util.js#L22>:\n    var inspect = util.inspect;\n    var formatRegExp = /%[sdj%]/g;\n    format = function format(f) {\n        if (typeof (f) !== 'string') {\n            var objects = [];\n            for (var i = 0; i < arguments.length; i++) {\n                objects.push(inspect(arguments[i]));\n            }\n            return objects.join(' ');\n        }\n\n        var i = 1;\n        var args = arguments;\n        var len = args.length;\n        var str = String(f).replace(formatRegExp, function (x) {\n            if (i >= len)\n                return x;\n            switch (x) {\n                case '%s': return String(args[i++]);\n                case '%d': return Number(args[i++]);\n                case '%j': return fastAndSafeJsonStringify(args[i++]);\n                case '%%': return '%';\n                default:\n                    return x;\n            }\n        });\n        for (var x = args[i]; i < len; x = args[++i]) {\n            if (x === null || typeof (x) !== 'object') {\n                str += ' ' + x;\n            } else {\n                str += ' ' + inspect(x);\n            }\n        }\n        return str;\n    };\n}\n\n\n/**\n * Gather some caller info 3 stack levels up.\n * See <http://code.google.com/p/v8/wiki/JavaScriptStackTraceApi>.\n */\nfunction getCaller3Info() {\n    if (this === undefined) {\n        // Cannot access caller info in 'strict' mode.\n        return;\n    }\n    var obj = {};\n    var saveLimit = Error.stackTraceLimit;\n    var savePrepare = Error.prepareStackTrace;\n    Error.stackTraceLimit = 3;\n\n    Error.prepareStackTrace = function (_, stack) {\n        var caller = stack[2];\n        if (sourceMapSupport) {\n            caller = sourceMapSupport.wrapCallSite(caller);\n        }\n        obj.file = caller.getFileName();\n        obj.line = caller.getLineNumber();\n        var func = caller.getFunctionName();\n        if (func)\n            obj.func = func;\n    };\n    Error.captureStackTrace(this, getCaller3Info);\n    this.stack;\n\n    Error.stackTraceLimit = saveLimit;\n    Error.prepareStackTrace = savePrepare;\n    return obj;\n}\n\n\nfunction _indent(s, indent) {\n    if (!indent) indent = '    ';\n    var lines = s.split(/\\r?\\n/g);\n    return indent + lines.join('\\n' + indent);\n}\n\n\n/**\n * Warn about an bunyan processing error.\n *\n * @param msg {String} Message with which to warn.\n * @param dedupKey {String} Optional. A short string key for this warning to\n *      have its warning only printed once.\n */\nfunction _warn(msg, dedupKey) {\n    assert.ok(msg);\n    if (dedupKey) {\n        if (_warned[dedupKey]) {\n            return;\n        }\n        _warned[dedupKey] = true;\n    }\n    process.stderr.write(msg + '\\n');\n}\nfunction _haveWarned(dedupKey) {\n    return _warned[dedupKey];\n}\nvar _warned = {};\n\n\nfunction ConsoleRawStream() {}\nConsoleRawStream.prototype.write = function (rec) {\n    if (rec.level < INFO) {\n        console.log(rec);\n    } else if (rec.level < WARN) {\n        console.info(rec);\n    } else if (rec.level < ERROR) {\n        console.warn(rec);\n    } else {\n        console.error(rec);\n    }\n};\n\n\n//---- Levels\n\nvar TRACE = 10;\nvar DEBUG = 20;\nvar INFO = 30;\nvar WARN = 40;\nvar ERROR = 50;\nvar FATAL = 60;\n\nvar levelFromName = {\n    'trace': TRACE,\n    'debug': DEBUG,\n    'info': INFO,\n    'warn': WARN,\n    'error': ERROR,\n    'fatal': FATAL\n};\nvar nameFromLevel = {};\nObject.keys(levelFromName).forEach(function (name) {\n    nameFromLevel[levelFromName[name]] = name;\n});\n\n// Dtrace probes.\nvar dtp = undefined;\nvar probes = dtrace && {};\n\n/**\n * Resolve a level number, name (upper or lowercase) to a level number value.\n *\n * @param nameOrNum {String|Number} A level name (case-insensitive) or positive\n *      integer level.\n * @api public\n */\nfunction resolveLevel(nameOrNum) {\n    var level;\n    var type = typeof (nameOrNum);\n    if (type === 'string') {\n        level = levelFromName[nameOrNum.toLowerCase()];\n        if (!level) {\n            throw new Error(format('unknown level name: \"%s\"', nameOrNum));\n        }\n    } else if (type !== 'number') {\n        throw new TypeError(format('cannot resolve level: invalid arg (%s):',\n            type, nameOrNum));\n    } else if (nameOrNum < 0 || Math.floor(nameOrNum) !== nameOrNum) {\n        throw new TypeError(format('level is not a positive integer: %s',\n            nameOrNum));\n    } else {\n        level = nameOrNum;\n    }\n    return level;\n}\n\n\nfunction isWritable(obj) {\n    if (obj instanceof stream.Writable) {\n        return true;\n    }\n    return typeof (obj.write) === 'function';\n}\n\n\n//---- Logger class\n\n/**\n * Create a Logger instance.\n *\n * @param options {Object} See documentation for full details. At minimum\n *    this must include a 'name' string key. Configuration keys:\n *      - `streams`: specify the logger output streams. This is an array of\n *        objects with these fields:\n *          - `type`: The stream type. See README.md for full details.\n *            Often this is implied by the other fields. Examples are\n *            'file', 'stream' and \"raw\".\n *          - `level`: Defaults to 'info'.\n *          - `path` or `stream`: The specify the file path or writeable\n *            stream to which log records are written. E.g.\n *            `stream: process.stdout`.\n *          - `closeOnExit` (boolean): Optional. Default is true for a\n *            'file' stream when `path` is given, false otherwise.\n *        See README.md for full details.\n *      - `level`: set the level for a single output stream (cannot be used\n *        with `streams`)\n *      - `stream`: the output stream for a logger with just one, e.g.\n *        `process.stdout` (cannot be used with `streams`)\n *      - `serializers`: object mapping log record field names to\n *        serializing functions. See README.md for details.\n *      - `src`: Boolean (default false). Set true to enable 'src' automatic\n *        field with log call source info.\n *    All other keys are log record fields.\n *\n * An alternative *internal* call signature is used for creating a child:\n *    new Logger(<parent logger>, <child options>[, <child opts are simple>]);\n *\n * @param _childSimple (Boolean) An assertion that the given `_childOptions`\n *    (a) only add fields (no config) and (b) no serialization handling is\n *    required for them. IOW, this is a fast path for frequent child\n *    creation.\n */\nfunction Logger(options, _childOptions, _childSimple) {\n    xxx('Logger start:', options)\n    if (!(this instanceof Logger)) {\n        return new Logger(options, _childOptions);\n    }\n\n    // Input arg validation.\n    var parent;\n    if (_childOptions !== undefined) {\n        parent = options;\n        options = _childOptions;\n        if (!(parent instanceof Logger)) {\n            throw new TypeError(\n                'invalid Logger creation: do not pass a second arg');\n        }\n    }\n    if (!options) {\n        throw new TypeError('options (object) is required');\n    }\n    if (!parent) {\n        if (!options.name) {\n            throw new TypeError('options.name (string) is required');\n        }\n    } else {\n        if (options.name) {\n            throw new TypeError(\n                'invalid options.name: child cannot set logger name');\n        }\n    }\n    if (options.stream && options.streams) {\n        throw new TypeError('cannot mix \"streams\" and \"stream\" options');\n    }\n    if (options.streams && !Array.isArray(options.streams)) {\n        throw new TypeError('invalid options.streams: must be an array')\n    }\n    if (options.serializers && (typeof (options.serializers) !== 'object' ||\n            Array.isArray(options.serializers))) {\n        throw new TypeError('invalid options.serializers: must be an object')\n    }\n\n    EventEmitter.call(this);\n\n    // Fast path for simple child creation.\n    if (parent && _childSimple) {\n        // `_isSimpleChild` is a signal to stream close handling that this child\n        // owns none of its streams.\n        this._isSimpleChild = true;\n\n        this._level = parent._level;\n        this.streams = parent.streams;\n        this.serializers = parent.serializers;\n        this.src = parent.src;\n        var fields = this.fields = {};\n        var parentFieldNames = Object.keys(parent.fields);\n        for (var i = 0; i < parentFieldNames.length; i++) {\n            var name = parentFieldNames[i];\n            fields[name] = parent.fields[name];\n        }\n        var names = Object.keys(options);\n        for (var i = 0; i < names.length; i++) {\n            var name = names[i];\n            fields[name] = options[name];\n        }\n        return;\n    }\n\n    // Start values.\n    var self = this;\n    if (parent) {\n        this._level = parent._level;\n        this.streams = [];\n        for (var i = 0; i < parent.streams.length; i++) {\n            var s = objCopy(parent.streams[i]);\n            s.closeOnExit = false; // Don't own parent stream.\n            this.streams.push(s);\n        }\n        this.serializers = objCopy(parent.serializers);\n        this.src = parent.src;\n        this.fields = objCopy(parent.fields);\n        if (options.level) {\n            this.level(options.level);\n        }\n    } else {\n        this._level = Number.POSITIVE_INFINITY;\n        this.streams = [];\n        this.serializers = null;\n        this.src = false;\n        this.fields = {};\n    }\n\n    if (!dtp && dtrace) {\n        dtp = dtrace.createDTraceProvider('bunyan');\n\n        for (var level in levelFromName) {\n            var probe;\n\n            probes[levelFromName[level]] = probe =\n                dtp.addProbe('log-' + level, 'char *');\n\n            // Explicitly add a reference to dtp to prevent it from being GC'd\n            probe.dtp = dtp;\n        }\n\n        dtp.enable();\n    }\n\n    // Handle *config* options (i.e. options that are not just plain data\n    // for log records).\n    if (options.stream) {\n        self.addStream({\n            type: 'stream',\n            stream: options.stream,\n            closeOnExit: false,\n            level: options.level\n        });\n    } else if (options.streams) {\n        options.streams.forEach(function (s) {\n            self.addStream(s, options.level);\n        });\n    } else if (parent && options.level) {\n        this.level(options.level);\n    } else if (!parent) {\n        if (runtimeEnv === 'browser') {\n            /*\n             * In the browser we'll be emitting to console.log by default.\n             * Any console.log worth its salt these days can nicely render\n             * and introspect objects (e.g. the Firefox and Chrome console)\n             * so let's emit the raw log record. Are there browsers for which\n             * that breaks things?\n             */\n            self.addStream({\n                type: 'raw',\n                stream: new ConsoleRawStream(),\n                closeOnExit: false,\n                level: options.level\n            });\n        } else {\n            self.addStream({\n                type: 'stream',\n                stream: process.stdout,\n                closeOnExit: false,\n                level: options.level\n            });\n        }\n    }\n    if (options.serializers) {\n        self.addSerializers(options.serializers);\n    }\n    if (options.src) {\n        this.src = true;\n    }\n    xxx('Logger: ', self)\n\n    // Fields.\n    // These are the default fields for log records (minus the attributes\n    // removed in this constructor). To allow storing raw log records\n    // (unrendered), `this.fields` must never be mutated. Create a copy for\n    // any changes.\n    var fields = objCopy(options);\n    delete fields.stream;\n    delete fields.level;\n    delete fields.streams;\n    delete fields.serializers;\n    delete fields.src;\n    if (this.serializers) {\n        this._applySerializers(fields);\n    }\n    if (!fields.hostname && !self.fields.hostname) {\n        fields.hostname = os.hostname();\n    }\n    if (!fields.pid) {\n        fields.pid = process.pid;\n    }\n    Object.keys(fields).forEach(function (k) {\n        self.fields[k] = fields[k];\n    });\n}\n\nutil.inherits(Logger, EventEmitter);\n\n\n/**\n * Add a stream\n *\n * @param stream {Object}. Object with these fields:\n *    - `type`: The stream type. See README.md for full details.\n *      Often this is implied by the other fields. Examples are\n *      'file', 'stream' and \"raw\".\n *    - `path` or `stream`: The specify the file path or writeable\n *      stream to which log records are written. E.g.\n *      `stream: process.stdout`.\n *    - `level`: Optional. Falls back to `defaultLevel`.\n *    - `closeOnExit` (boolean): Optional. Default is true for a\n *      'file' stream when `path` is given, false otherwise.\n *    See README.md for full details.\n * @param defaultLevel {Number|String} Optional. A level to use if\n *      `stream.level` is not set. If neither is given, this defaults to INFO.\n */\nLogger.prototype.addStream = function addStream(s, defaultLevel) {\n    var self = this;\n    if (defaultLevel === null || defaultLevel === undefined) {\n        defaultLevel = INFO;\n    }\n\n    s = objCopy(s);\n\n    // Implicit 'type' from other args.\n    if (!s.type) {\n        if (s.stream) {\n            s.type = 'stream';\n        } else if (s.path) {\n            s.type = 'file'\n        }\n    }\n    s.raw = (s.type === 'raw');  // PERF: Allow for faster check in `_emit`.\n\n    if (s.level !== undefined) {\n        s.level = resolveLevel(s.level);\n    } else {\n        s.level = resolveLevel(defaultLevel);\n    }\n    if (s.level < self._level) {\n        self._level = s.level;\n    }\n\n    switch (s.type) {\n    case 'stream':\n        assert.ok(isWritable(s.stream),\n                  '\"stream\" stream is not writable: ' + util.inspect(s.stream));\n\n        if (!s.closeOnExit) {\n            s.closeOnExit = false;\n        }\n        break;\n    case 'file':\n        if (s.reemitErrorEvents === undefined) {\n            s.reemitErrorEvents = true;\n        }\n        if (!s.stream) {\n            s.stream = fs.createWriteStream(s.path,\n                                            {flags: 'a', encoding: 'utf8'});\n            if (!s.closeOnExit) {\n                s.closeOnExit = true;\n            }\n        } else {\n            if (!s.closeOnExit) {\n                s.closeOnExit = false;\n            }\n        }\n        break;\n    case 'rotating-file':\n        assert.ok(!s.stream,\n                  '\"rotating-file\" stream should not give a \"stream\"');\n        assert.ok(s.path);\n        assert.ok(mv, '\"rotating-file\" stream type is not supported: '\n                      + 'missing \"mv\" module');\n        s.stream = new RotatingFileStream(s);\n        if (!s.closeOnExit) {\n            s.closeOnExit = true;\n        }\n        break;\n    case 'raw':\n        if (!s.closeOnExit) {\n            s.closeOnExit = false;\n        }\n        break;\n    default:\n        throw new TypeError('unknown stream type \"' + s.type + '\"');\n    }\n\n    if (s.reemitErrorEvents && typeof (s.stream.on) === 'function') {\n        // TODO: When we have `<logger>.close()`, it should remove event\n        //      listeners to not leak Logger instances.\n        s.stream.on('error', function onStreamError(err) {\n            self.emit('error', err, s);\n        });\n    }\n\n    self.streams.push(s);\n    delete self.haveNonRawStreams;  // reset\n}\n\n\n/**\n * Add serializers\n *\n * @param serializers {Object} Optional. Object mapping log record field names\n *    to serializing functions. See README.md for details.\n */\nLogger.prototype.addSerializers = function addSerializers(serializers) {\n    var self = this;\n\n    if (!self.serializers) {\n        self.serializers = {};\n    }\n    Object.keys(serializers).forEach(function (field) {\n        var serializer = serializers[field];\n        if (typeof (serializer) !== 'function') {\n            throw new TypeError(format(\n                'invalid serializer for \"%s\" field: must be a function',\n                field));\n        } else {\n            self.serializers[field] = serializer;\n        }\n    });\n}\n\n\n\n/**\n * Create a child logger, typically to add a few log record fields.\n *\n * This can be useful when passing a logger to a sub-component, e.g. a\n * 'wuzzle' component of your service:\n *\n *    var wuzzleLog = log.child({component: 'wuzzle'})\n *    var wuzzle = new Wuzzle({..., log: wuzzleLog})\n *\n * Then log records from the wuzzle code will have the same structure as\n * the app log, *plus the component='wuzzle' field*.\n *\n * @param options {Object} Optional. Set of options to apply to the child.\n *    All of the same options for a new Logger apply here. Notes:\n *      - The parent's streams are inherited and cannot be removed in this\n *        call. Any given `streams` are *added* to the set inherited from\n *        the parent.\n *      - The parent's serializers are inherited, though can effectively be\n *        overwritten by using duplicate keys.\n *      - Can use `level` to set the level of the streams inherited from\n *        the parent. The level for the parent is NOT affected.\n * @param simple {Boolean} Optional. Set to true to assert that `options`\n *    (a) only add fields (no config) and (b) no serialization handling is\n *    required for them. IOW, this is a fast path for frequent child\n *    creation. See 'tools/timechild.js' for numbers.\n */\nLogger.prototype.child = function (options, simple) {\n    return new (this.constructor)(this, options || {}, simple);\n}\n\n\n/**\n * A convenience method to reopen 'file' streams on a logger. This can be\n * useful with external log rotation utilities that move and re-open log files\n * (e.g. logrotate on Linux, logadm on SmartOS/Illumos). Those utilities\n * typically have rotation options to copy-and-truncate the log file, but\n * you may not want to use that. An alternative is to do this in your\n * application:\n *\n *      var log = bunyan.createLogger(...);\n *      ...\n *      process.on('SIGUSR2', function () {\n *          log.reopenFileStreams();\n *      });\n *      ...\n *\n * See <https://github.com/trentm/node-bunyan/issues/104>.\n */\nLogger.prototype.reopenFileStreams = function () {\n    var self = this;\n    self.streams.forEach(function (s) {\n        if (s.type === 'file') {\n            if (s.stream) {\n                // Not sure if typically would want this, or more immediate\n                // `s.stream.destroy()`.\n                s.stream.end();\n                s.stream.destroySoon();\n                delete s.stream;\n            }\n            s.stream = fs.createWriteStream(s.path,\n                {flags: 'a', encoding: 'utf8'});\n            s.stream.on('error', function (err) {\n                self.emit('error', err, s);\n            });\n        }\n    });\n};\n\n\n/* BEGIN JSSTYLED */\n/**\n * Close this logger.\n *\n * This closes streams (that it owns, as per 'endOnClose' attributes on\n * streams), etc. Typically you **don't** need to bother calling this.\nLogger.prototype.close = function () {\n    if (this._closed) {\n        return;\n    }\n    if (!this._isSimpleChild) {\n        self.streams.forEach(function (s) {\n            if (s.endOnClose) {\n                xxx('closing stream s:', s);\n                s.stream.end();\n                s.endOnClose = false;\n            }\n        });\n    }\n    this._closed = true;\n}\n */\n/* END JSSTYLED */\n\n\n/**\n * Get/set the level of all streams on this logger.\n *\n * Get Usage:\n *    // Returns the current log level (lowest level of all its streams).\n *    log.level() -> INFO\n *\n * Set Usage:\n *    log.level(INFO)       // set all streams to level INFO\n *    log.level('info')     // can use 'info' et al aliases\n */\nLogger.prototype.level = function level(value) {\n    if (value === undefined) {\n        return this._level;\n    }\n    var newLevel = resolveLevel(value);\n    var len = this.streams.length;\n    for (var i = 0; i < len; i++) {\n        this.streams[i].level = newLevel;\n    }\n    this._level = newLevel;\n}\n\n\n/**\n * Get/set the level of a particular stream on this logger.\n *\n * Get Usage:\n *    // Returns an array of the levels of each stream.\n *    log.levels() -> [TRACE, INFO]\n *\n *    // Returns a level of the identified stream.\n *    log.levels(0) -> TRACE      // level of stream at index 0\n *    log.levels('foo')           // level of stream with name 'foo'\n *\n * Set Usage:\n *    log.levels(0, INFO)         // set level of stream 0 to INFO\n *    log.levels(0, 'info')       // can use 'info' et al aliases\n *    log.levels('foo', WARN)     // set stream named 'foo' to WARN\n *\n * Stream names: When streams are defined, they can optionally be given\n * a name. For example,\n *       log = new Logger({\n *         streams: [\n *           {\n *             name: 'foo',\n *             path: '/var/log/my-service/foo.log'\n *             level: 'trace'\n *           },\n *         ...\n *\n * @param name {String|Number} The stream index or name.\n * @param value {Number|String} The level value (INFO) or alias ('info').\n *    If not given, this is a 'get' operation.\n * @throws {Error} If there is no stream with the given name.\n */\nLogger.prototype.levels = function levels(name, value) {\n    if (name === undefined) {\n        assert.equal(value, undefined);\n        return this.streams.map(\n            function (s) { return s.level });\n    }\n    var stream;\n    if (typeof (name) === 'number') {\n        stream = this.streams[name];\n        if (stream === undefined) {\n            throw new Error('invalid stream index: ' + name);\n        }\n    } else {\n        var len = this.streams.length;\n        for (var i = 0; i < len; i++) {\n            var s = this.streams[i];\n            if (s.name === name) {\n                stream = s;\n                break;\n            }\n        }\n        if (!stream) {\n            throw new Error(format('no stream with name \"%s\"', name));\n        }\n    }\n    if (value === undefined) {\n        return stream.level;\n    } else {\n        var newLevel = resolveLevel(value);\n        stream.level = newLevel;\n        if (newLevel < this._level) {\n            this._level = newLevel;\n        }\n    }\n}\n\n\n/**\n * Apply registered serializers to the appropriate keys in the given fields.\n *\n * Pre-condition: This is only called if there is at least one serializer.\n *\n * @param fields (Object) The log record fields.\n * @param excludeFields (Object) Optional mapping of keys to `true` for\n *    keys to NOT apply a serializer.\n */\nLogger.prototype._applySerializers = function (fields, excludeFields) {\n    var self = this;\n\n    xxx('_applySerializers: excludeFields', excludeFields);\n\n    // Check each serializer against these (presuming number of serializers\n    // is typically less than number of fields).\n    Object.keys(this.serializers).forEach(function (name) {\n        if (fields[name] === undefined ||\n            (excludeFields && excludeFields[name]))\n        {\n            return;\n        }\n        xxx('_applySerializers; apply to \"%s\" key', name)\n        try {\n            fields[name] = self.serializers[name](fields[name]);\n        } catch (err) {\n            _warn(format('bunyan: ERROR: Exception thrown from the \"%s\" '\n                + 'Bunyan serializer. This should never happen. This is a bug '\n                + 'in that serializer function.\\n%s',\n                name, err.stack || err));\n            fields[name] = format('(Error in Bunyan log \"%s\" serializer '\n                + 'broke field. See stderr for details.)', name);\n        }\n    });\n}\n\n\n/**\n * Emit a log record.\n *\n * @param rec {log record}\n * @param noemit {Boolean} Optional. Set to true to skip emission\n *      and just return the JSON string.\n */\nLogger.prototype._emit = function (rec, noemit) {\n    var i;\n\n    // Lazily determine if this Logger has non-'raw' streams. If there are\n    // any, then we need to stringify the log record.\n    if (this.haveNonRawStreams === undefined) {\n        this.haveNonRawStreams = false;\n        for (i = 0; i < this.streams.length; i++) {\n            if (!this.streams[i].raw) {\n                this.haveNonRawStreams = true;\n                break;\n            }\n        }\n    }\n\n    // Stringify the object (creates a warning str on error).\n    var str;\n    if (noemit || this.haveNonRawStreams) {\n        str = fastAndSafeJsonStringify(rec) + '\\n';\n    }\n\n    if (noemit)\n        return str;\n\n    var level = rec.level;\n    for (i = 0; i < this.streams.length; i++) {\n        var s = this.streams[i];\n        if (s.level <= level) {\n            xxx('writing log rec \"%s\" to \"%s\" stream (%d <= %d): %j',\n                rec.msg, s.type, s.level, level, rec);\n            s.stream.write(s.raw ? rec : str);\n        }\n    };\n\n    return str;\n}\n\n\n/**\n * Build a record object suitable for emitting from the arguments\n * provided to the a log emitter.\n */\nfunction mkRecord(log, minLevel, args) {\n    var excludeFields, fields, msgArgs;\n    if (args[0] instanceof Error) {\n        // `log.<level>(err, ...)`\n        fields = {\n            // Use this Logger's err serializer, if defined.\n            err: (log.serializers && log.serializers.err\n                ? log.serializers.err(args[0])\n                : Logger.stdSerializers.err(args[0]))\n        };\n        excludeFields = {err: true};\n        if (args.length === 1) {\n            msgArgs = [fields.err.message];\n        } else {\n            msgArgs = args.slice(1);\n        }\n    } else if (typeof (args[0]) !== 'object' || Array.isArray(args[0])) {\n        // `log.<level>(msg, ...)`\n        fields = null;\n        msgArgs = args.slice();\n    } else if (Buffer.isBuffer(args[0])) {  // `log.<level>(buf, ...)`\n        // Almost certainly an error, show `inspect(buf)`. See bunyan\n        // issue #35.\n        fields = null;\n        msgArgs = args.slice();\n        msgArgs[0] = util.inspect(msgArgs[0]);\n    } else {  // `log.<level>(fields, msg, ...)`\n        fields = args[0];\n        if (fields && args.length === 1 && fields.err &&\n            fields.err instanceof Error)\n        {\n            msgArgs = [fields.err.message];\n        } else {\n            msgArgs = args.slice(1);\n        }\n    }\n\n    // Build up the record object.\n    var rec = objCopy(log.fields);\n    var level = rec.level = minLevel;\n    var recFields = (fields ? objCopy(fields) : null);\n    if (recFields) {\n        if (log.serializers) {\n            log._applySerializers(recFields, excludeFields);\n        }\n        Object.keys(recFields).forEach(function (k) {\n            rec[k] = recFields[k];\n        });\n    }\n    rec.msg = format.apply(log, msgArgs);\n    if (!rec.time) {\n        rec.time = (new Date());\n    }\n    // Get call source info\n    if (log.src && !rec.src) {\n        rec.src = getCaller3Info()\n    }\n    rec.v = LOG_VERSION;\n\n    return rec;\n};\n\n\n/**\n * Build an array that dtrace-provider can use to fire a USDT probe. If we've\n * already built the appropriate string, we use it. Otherwise, build the\n * record object and stringify it.\n */\nfunction mkProbeArgs(str, log, minLevel, msgArgs) {\n    return [ str || log._emit(mkRecord(log, minLevel, msgArgs), true) ];\n}\n\n\n/**\n * Build a log emitter function for level minLevel. I.e. this is the\n * creator of `log.info`, `log.error`, etc.\n */\nfunction mkLogEmitter(minLevel) {\n    return function () {\n        var log = this;\n        var str = null;\n        var rec = null;\n\n        if (!this._emit) {\n            /*\n             * Show this invalid Bunyan usage warning *once*.\n             *\n             * See <https://github.com/trentm/node-bunyan/issues/100> for\n             * an example of how this can happen.\n             */\n            var dedupKey = 'unbound';\n            if (!_haveWarned[dedupKey]) {\n                var caller = getCaller3Info();\n                _warn(format('bunyan usage error: %s:%s: attempt to log '\n                    + 'with an unbound log method: `this` is: %s',\n                    caller.file, caller.line, util.inspect(this)),\n                    dedupKey);\n            }\n            return;\n        } else if (arguments.length === 0) {   // `log.<level>()`\n            return (this._level <= minLevel);\n        }\n\n        var msgArgs = new Array(arguments.length);\n        for (var i = 0; i < msgArgs.length; ++i) {\n            msgArgs[i] = arguments[i];\n        }\n\n        if (this._level <= minLevel) {\n            rec = mkRecord(log, minLevel, msgArgs);\n            str = this._emit(rec);\n        }\n\n        if (probes) {\n            probes[minLevel].fire(mkProbeArgs, str, log, minLevel, msgArgs);\n        }\n    }\n}\n\n\n/**\n * The functions below log a record at a specific level.\n *\n * Usages:\n *    log.<level>()  -> boolean is-trace-enabled\n *    log.<level>(<Error> err, [<string> msg, ...])\n *    log.<level>(<string> msg, ...)\n *    log.<level>(<object> fields, <string> msg, ...)\n *\n * where <level> is the lowercase version of the log level. E.g.:\n *\n *    log.info()\n *\n * @params fields {Object} Optional set of additional fields to log.\n * @params msg {String} Log message. This can be followed by additional\n *    arguments that are handled like\n *    [util.format](http://nodejs.org/docs/latest/api/all.html#util.format).\n */\nLogger.prototype.trace = mkLogEmitter(TRACE);\nLogger.prototype.debug = mkLogEmitter(DEBUG);\nLogger.prototype.info = mkLogEmitter(INFO);\nLogger.prototype.warn = mkLogEmitter(WARN);\nLogger.prototype.error = mkLogEmitter(ERROR);\nLogger.prototype.fatal = mkLogEmitter(FATAL);\n\n\n\n//---- Standard serializers\n// A serializer is a function that serializes a JavaScript object to a\n// JSON representation for logging. There is a standard set of presumed\n// interesting objects in node.js-land.\n\nLogger.stdSerializers = {};\n\n// Serialize an HTTP request.\nLogger.stdSerializers.req = function (req) {\n    if (!req || !req.connection)\n        return req;\n    return {\n        method: req.method,\n        url: req.url,\n        headers: req.headers,\n        remoteAddress: req.connection.remoteAddress,\n        remotePort: req.connection.remotePort\n    };\n    // Trailers: Skipping for speed. If you need trailers in your app, then\n    // make a custom serializer.\n    //if (Object.keys(trailers).length > 0) {\n    //  obj.trailers = req.trailers;\n    //}\n};\n\n// Serialize an HTTP response.\nLogger.stdSerializers.res = function (res) {\n    if (!res || !res.statusCode)\n        return res;\n    return {\n        statusCode: res.statusCode,\n        header: res._header\n    }\n};\n\n\n/*\n * This function dumps long stack traces for exceptions having a cause()\n * method. The error classes from\n * [verror](https://github.com/davepacheco/node-verror) and\n * [restify v2.0](https://github.com/mcavage/node-restify) are examples.\n *\n * Based on `dumpException` in\n * https://github.com/davepacheco/node-extsprintf/blob/master/lib/extsprintf.js\n */\nfunction getFullErrorStack(ex)\n{\n    var ret = ex.stack || ex.toString();\n    if (ex.cause && typeof (ex.cause) === 'function') {\n        var cex = ex.cause();\n        if (cex) {\n            ret += '\\nCaused by: ' + getFullErrorStack(cex);\n        }\n    }\n    return (ret);\n}\n\n// Serialize an Error object\n// (Core error properties are enumerable in node 0.4, not in 0.6).\nvar errSerializer = Logger.stdSerializers.err = function (err) {\n    if (!err || !err.stack)\n        return err;\n    var obj = {\n        message: err.message,\n        name: err.name,\n        stack: getFullErrorStack(err),\n        code: err.code,\n        signal: err.signal\n    }\n    return obj;\n};\n\n\n// A JSON stringifier that handles cycles safely - tracks seen values in a Set.\nfunction safeCyclesSet() {\n    var seen = new Set();\n    return function (key, val) {\n        if (!val || typeof (val) !== 'object') {\n            return val;\n        }\n        if (seen.has(val)) {\n            return '[Circular]';\n        }\n        seen.add(val);\n        return val;\n    };\n}\n\n/**\n * A JSON stringifier that handles cycles safely - tracks seen vals in an Array.\n *\n * Note: This approach has performance problems when dealing with large objects,\n * see trentm/node-bunyan#445, but since this is the only option for node 0.10\n * and earlier (as Set was introduced in Node 0.12), it's used as a fallback\n * when Set is not available.\n */\nfunction safeCyclesArray() {\n    var seen = [];\n    return function (key, val) {\n        if (!val || typeof (val) !== 'object') {\n            return val;\n        }\n        if (seen.indexOf(val) !== -1) {\n            return '[Circular]';\n        }\n        seen.push(val);\n        return val;\n    };\n}\n\n/**\n * A JSON stringifier that handles cycles safely.\n *\n * Usage: JSON.stringify(obj, safeCycles())\n *\n * Choose the best safe cycle function from what is available - see\n * trentm/node-bunyan#445.\n */\nvar safeCycles = typeof (Set) !== 'undefined' ? safeCyclesSet : safeCyclesArray;\n\n/**\n * A fast JSON.stringify that handles cycles and getter exceptions (when\n * safeJsonStringify is installed).\n *\n * This function attempts to use the regular JSON.stringify for speed, but on\n * error (e.g. JSON cycle detection exception) it falls back to safe stringify\n * handlers that can deal with cycles and/or getter exceptions.\n */\nfunction fastAndSafeJsonStringify(rec) {\n    try {\n        return JSON.stringify(rec);\n    } catch (ex) {\n        try {\n            return JSON.stringify(rec, safeCycles());\n        } catch (e) {\n            if (safeJsonStringify) {\n                return safeJsonStringify(rec);\n            } else {\n                var dedupKey = e.stack.split(/\\n/g, 3).join('\\n');\n                _warn('bunyan: ERROR: Exception in '\n                    + '`JSON.stringify(rec)`. You can install the '\n                    + '\"safe-json-stringify\" module to have Bunyan fallback '\n                    + 'to safer stringification. Record:\\n'\n                    + _indent(format('%s\\n%s', util.inspect(rec), e.stack)),\n                    dedupKey);\n                return format('(Exception in JSON.stringify(rec): %j. '\n                    + 'See stderr for details.)', e.message);\n            }\n        }\n    }\n}\n\n\nvar RotatingFileStream = null;\nif (mv) {\n\nRotatingFileStream = function RotatingFileStream(options) {\n    this.path = options.path;\n\n    this.count = (options.count == null ? 10 : options.count);\n    assert.equal(typeof (this.count), 'number',\n        format('rotating-file stream \"count\" is not a number: %j (%s) in %j',\n            this.count, typeof (this.count), this));\n    assert.ok(this.count >= 0,\n        format('rotating-file stream \"count\" is not >= 0: %j in %j',\n            this.count, this));\n\n    // Parse `options.period`.\n    if (options.period) {\n        // <number><scope> where scope is:\n        //    h   hours (at the start of the hour)\n        //    d   days (at the start of the day, i.e. just after midnight)\n        //    w   weeks (at the start of Sunday)\n        //    m   months (on the first of the month)\n        //    y   years (at the start of Jan 1st)\n        // with special values 'hourly' (1h), 'daily' (1d), \"weekly\" (1w),\n        // 'monthly' (1m) and 'yearly' (1y)\n        var period = {\n            'hourly': '1h',\n            'daily': '1d',\n            'weekly': '1w',\n            'monthly': '1m',\n            'yearly': '1y'\n        }[options.period] || options.period;\n        var m = /^([1-9][0-9]*)([hdwmy]|ms)$/.exec(period);\n        if (!m) {\n            throw new Error(format('invalid period: \"%s\"', options.period));\n        }\n        this.periodNum = Number(m[1]);\n        this.periodScope = m[2];\n    } else {\n        this.periodNum = 1;\n        this.periodScope = 'd';\n    }\n\n    var lastModified = null;\n    try {\n        var fileInfo = fs.statSync(this.path);\n        lastModified = fileInfo.mtime.getTime();\n    }\n    catch (err) {\n        // file doesn't exist\n    }\n    var rotateAfterOpen = false;\n    if (lastModified) {\n        var lastRotTime = this._calcRotTime(0);\n        if (lastModified < lastRotTime) {\n            rotateAfterOpen = true;\n        }\n    }\n\n    // TODO: template support for backup files\n    // template: <path to which to rotate>\n    //      default is %P.%n\n    //      '/var/log/archive/foo.log'  -> foo.log.%n\n    //      '/var/log/archive/foo.log.%n'\n    //      codes:\n    //          XXX support strftime codes (per node version of those)\n    //              or whatever module. Pick non-colliding for extra\n    //              codes\n    //          %P      `path` base value\n    //          %n      integer number of rotated log (1,2,3,...)\n    //          %d      datetime in YYYY-MM-DD_HH-MM-SS\n    //                      XXX what should default date format be?\n    //                          prior art? Want to avoid ':' in\n    //                          filenames (illegal on Windows for one).\n\n    this.stream = fs.createWriteStream(this.path,\n        {flags: 'a', encoding: 'utf8'});\n\n    this.rotQueue = [];\n    this.rotating = false;\n    if (rotateAfterOpen) {\n        this._debug('rotateAfterOpen -> call rotate()');\n        this.rotate();\n    } else {\n        this._setupNextRot();\n    }\n}\n\nutil.inherits(RotatingFileStream, EventEmitter);\n\nRotatingFileStream.prototype._debug = function () {\n    // Set this to `true` to add debug logging.\n    if (false) {\n        if (arguments.length === 0) {\n            return true;\n        }\n        var args = Array.prototype.slice.call(arguments);\n        args[0] = '[' + (new Date().toISOString()) + ', '\n            + this.path + '] ' + args[0];\n        console.log.apply(this, args);\n    } else {\n        return false;\n    }\n};\n\nRotatingFileStream.prototype._setupNextRot = function () {\n    this.rotAt = this._calcRotTime(1);\n    this._setRotationTimer();\n}\n\nRotatingFileStream.prototype._setRotationTimer = function () {\n    var self = this;\n    var delay = this.rotAt - Date.now();\n    // Cap timeout to Node's max setTimeout, see\n    // <https://github.com/joyent/node/issues/8656>.\n    var TIMEOUT_MAX = 2147483647; // 2^31-1\n    if (delay > TIMEOUT_MAX) {\n        delay = TIMEOUT_MAX;\n    }\n    this.timeout = setTimeout(\n        function () {\n            self._debug('_setRotationTimer timeout -> call rotate()');\n            self.rotate();\n        },\n        delay);\n    if (typeof (this.timeout.unref) === 'function') {\n        this.timeout.unref();\n    }\n}\n\nRotatingFileStream.prototype._calcRotTime =\nfunction _calcRotTime(periodOffset) {\n    this._debug('_calcRotTime: %s%s', this.periodNum, this.periodScope);\n    var d = new Date();\n\n    this._debug('  now local: %s', d);\n    this._debug('    now utc: %s', d.toISOString());\n    var rotAt;\n    switch (this.periodScope) {\n    case 'ms':\n        // Hidden millisecond period for debugging.\n        if (this.rotAt) {\n            rotAt = this.rotAt + this.periodNum * periodOffset;\n        } else {\n            rotAt = Date.now() + this.periodNum * periodOffset;\n        }\n        break;\n    case 'h':\n        if (this.rotAt) {\n            rotAt = this.rotAt + this.periodNum * 60 * 60 * 1000 * periodOffset;\n        } else {\n            // First time: top of the next hour.\n            rotAt = Date.UTC(d.getUTCFullYear(), d.getUTCMonth(),\n                d.getUTCDate(), d.getUTCHours() + periodOffset);\n        }\n        break;\n    case 'd':\n        if (this.rotAt) {\n            rotAt = this.rotAt + this.periodNum * 24 * 60 * 60 * 1000\n                * periodOffset;\n        } else {\n            // First time: start of tomorrow (i.e. at the coming midnight) UTC.\n            rotAt = Date.UTC(d.getUTCFullYear(), d.getUTCMonth(),\n                d.getUTCDate() + periodOffset);\n        }\n        break;\n    case 'w':\n        // Currently, always on Sunday morning at 00:00:00 (UTC).\n        if (this.rotAt) {\n            rotAt = this.rotAt + this.periodNum * 7 * 24 * 60 * 60 * 1000\n                * periodOffset;\n        } else {\n            // First time: this coming Sunday.\n            var dayOffset = (7 - d.getUTCDay());\n            if (periodOffset < 1) {\n                dayOffset = -d.getUTCDay();\n            }\n            if (periodOffset > 1 || periodOffset < -1) {\n                dayOffset += 7 * periodOffset;\n            }\n            rotAt = Date.UTC(d.getUTCFullYear(), d.getUTCMonth(),\n                d.getUTCDate() + dayOffset);\n        }\n        break;\n    case 'm':\n        if (this.rotAt) {\n            rotAt = Date.UTC(d.getUTCFullYear(),\n                d.getUTCMonth() + this.periodNum * periodOffset, 1);\n        } else {\n            // First time: the start of the next month.\n            rotAt = Date.UTC(d.getUTCFullYear(),\n                d.getUTCMonth() + periodOffset, 1);\n        }\n        break;\n    case 'y':\n        if (this.rotAt) {\n            rotAt = Date.UTC(d.getUTCFullYear() + this.periodNum * periodOffset,\n                0, 1);\n        } else {\n            // First time: the start of the next year.\n            rotAt = Date.UTC(d.getUTCFullYear() + periodOffset, 0, 1);\n        }\n        break;\n    default:\n        assert.fail(format('invalid period scope: \"%s\"', this.periodScope));\n    }\n\n    if (this._debug()) {\n        this._debug('  **rotAt**: %s (utc: %s)', rotAt,\n            new Date(rotAt).toUTCString());\n        var now = Date.now();\n        this._debug('        now: %s (%sms == %smin == %sh to go)',\n            now,\n            rotAt - now,\n            (rotAt-now)/1000/60,\n            (rotAt-now)/1000/60/60);\n    }\n    return rotAt;\n};\n\nRotatingFileStream.prototype.rotate = function rotate() {\n    // XXX What about shutdown?\n    var self = this;\n\n    // If rotation period is > ~25 days, we have to break into multiple\n    // setTimeout's. See <https://github.com/joyent/node/issues/8656>.\n    if (self.rotAt && self.rotAt > Date.now()) {\n        return self._setRotationTimer();\n    }\n\n    this._debug('rotate');\n    if (self.rotating) {\n        throw new TypeError('cannot start a rotation when already rotating');\n    }\n    self.rotating = true;\n\n    self.stream.end();  // XXX can do moves sync after this? test at high rate\n\n    function del() {\n        var toDel = self.path + '.' + String(n - 1);\n        if (n === 0) {\n            toDel = self.path;\n        }\n        n -= 1;\n        self._debug('  rm %s', toDel);\n        fs.unlink(toDel, function (delErr) {\n            //XXX handle err other than not exists\n            moves();\n        });\n    }\n\n    function moves() {\n        if (self.count === 0 || n < 0) {\n            return finish();\n        }\n        var before = self.path;\n        var after = self.path + '.' + String(n);\n        if (n > 0) {\n            before += '.' + String(n - 1);\n        }\n        n -= 1;\n        fs.exists(before, function (exists) {\n            if (!exists) {\n                moves();\n            } else {\n                self._debug('  mv %s %s', before, after);\n                mv(before, after, function (mvErr) {\n                    if (mvErr) {\n                        self.emit('error', mvErr);\n                        finish(); // XXX finish here?\n                    } else {\n                        moves();\n                    }\n                });\n            }\n        })\n    }\n\n    function finish() {\n        self._debug('  open %s', self.path);\n        self.stream = fs.createWriteStream(self.path,\n            {flags: 'a', encoding: 'utf8'});\n        var q = self.rotQueue, len = q.length;\n        for (var i = 0; i < len; i++) {\n            self.stream.write(q[i]);\n        }\n        self.rotQueue = [];\n        self.rotating = false;\n        self.emit('drain');\n        self._setupNextRot();\n    }\n\n    var n = this.count;\n    del();\n};\n\nRotatingFileStream.prototype.write = function write(s) {\n    if (this.rotating) {\n        this.rotQueue.push(s);\n        return false;\n    } else {\n        return this.stream.write(s);\n    }\n};\n\nRotatingFileStream.prototype.end = function end(s) {\n    this.stream.end();\n};\n\nRotatingFileStream.prototype.destroy = function destroy(s) {\n    this.stream.destroy();\n};\n\nRotatingFileStream.prototype.destroySoon = function destroySoon(s) {\n    this.stream.destroySoon();\n};\n\n} /* if (mv) */\n\n\n\n/**\n * RingBuffer is a Writable Stream that just stores the last N records in\n * memory.\n *\n * @param options {Object}, with the following fields:\n *\n *    - limit: number of records to keep in memory\n */\nfunction RingBuffer(options) {\n    this.limit = options && options.limit ? options.limit : 100;\n    this.writable = true;\n    this.records = [];\n    EventEmitter.call(this);\n}\n\nutil.inherits(RingBuffer, EventEmitter);\n\nRingBuffer.prototype.write = function (record) {\n    if (!this.writable)\n        throw (new Error('RingBuffer has been ended already'));\n\n    this.records.push(record);\n\n    if (this.records.length > this.limit)\n        this.records.shift();\n\n    return (true);\n};\n\nRingBuffer.prototype.end = function () {\n    if (arguments.length > 0)\n        this.write.apply(this, Array.prototype.slice.call(arguments));\n    this.writable = false;\n};\n\nRingBuffer.prototype.destroy = function () {\n    this.writable = false;\n    this.emit('close');\n};\n\nRingBuffer.prototype.destroySoon = function () {\n    this.destroy();\n};\n\n\n//---- Exports\n\nmodule.exports = Logger;\n\nmodule.exports.TRACE = TRACE;\nmodule.exports.DEBUG = DEBUG;\nmodule.exports.INFO = INFO;\nmodule.exports.WARN = WARN;\nmodule.exports.ERROR = ERROR;\nmodule.exports.FATAL = FATAL;\nmodule.exports.resolveLevel = resolveLevel;\nmodule.exports.levelFromName = levelFromName;\nmodule.exports.nameFromLevel = nameFromLevel;\n\n// module.exports.VERSION = require('../package.json').version;\nmodule.exports.VERSION = 'HZHZHZHZH';\nmodule.exports.LOG_VERSION = LOG_VERSION;\n\nmodule.exports.createLogger = function createLogger(options) {\n    return new Logger(options);\n};\n\nmodule.exports.RingBuffer = RingBuffer;\nmodule.exports.RotatingFileStream = RotatingFileStream;\n\n// Useful for custom `type == 'raw'` streams that may do JSON stringification\n// of log records themselves. Usage:\n//    var str = JSON.stringify(rec, bunyan.safeCycles());\nmodule.exports.safeCycles = safeCycles;\n"],"file":"index.js"}